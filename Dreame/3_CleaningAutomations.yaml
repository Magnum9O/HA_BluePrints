blueprint:
  name: ðŸ¤– [DEV 3.0] Dreame Vacuum - Automazione Pulizie SEMPLIFICATA
  description: |
    ðŸš€ **AUTOMAZIONE SEMPLIFICATA PER DREAME VACUUM**
    
    ðŸ“… **VISUALIZZA RIEPILOGO SCHEDULAZIONI** (clicca per espandere)
    
    Una volta creata l'automazione, **copia questo codice** e incollalo in:
    **Strumenti Sviluppatore â†’ Template**
    
    ```
    ## ðŸ“… IL TUO PIANO PULIZIE DREAME
    
    ### ðŸ—“ï¸ SLOT PRINCIPALE
    {% for day in ['lunedÃ¬', 'martedÃ¬', 'mercoledÃ¬', 'giovedÃ¬', 'venerdÃ¬', 'sabato', 'domenica'] %}
    {% if day in states.input_select.main_weekdays.state.split(',') %}
    **{{ day.title() }}:**
    {% if states('input_boolean.main_morning_on') == 'on' %}
    - ðŸŒ… {{ states('input_datetime.main_morning_time') }} â†’ {{ states('input_select.main_morning_preset') }}
    Stanze: {{ states('input_text.main_morning_rooms') or 'Tutta casa' }}
    {% endif %}
    {% if states('input_boolean.main_evening_on') == 'on' %}
    - ðŸŒ™ {{ states('input_datetime.main_evening_time') }} â†’ Logica: {{ states('input_select.main_evening_conditional') }}
    {% endif %}
    {% endif %}
    {% endfor %}
    
    ### ðŸŽ¯ SCHEDULAZIONI AGGIUNTIVE 
    {% for i in range(1, 5) %}
    {% if states('input_boolean.schedule' + i|string + '_on') == 'on' %}
    **Schedulazione {{ i }}:**
    [Giorni configurati: {{ states('input_select.schedule' + i|string + '_weekdays').split(',') | join(', ') }}]
    {% endif %}
    {% endfor %}
    
    ### âš ï¸ ATTENZIONE
    Verifica che non ci siano sovrapposizioni di giorni tra schedulazioni diverse!
    ```
    
    **Ti mostrerÃ  esattamente quando e dove Ã¨ programmato il robot.**
    Se vedi conflitti, modifica l'automazione e ricontrolla.
    
    ðŸ¤– **Automazione semplificata per robot Dreame**
    
    âœ¨ **FunzionalitÃ :**
    - ðŸ”„ Logica adattiva (sera si adatta al mattino)
    - ðŸ¤– Controllo stato robot prima dell'avvio
    - ðŸ”” Notifiche Alexa opzionali
    - ðŸ› Debug completo per troubleshooting
    - âœ¨ **SEMPLIFICATO**: Una pulizia per slot, zero complessitÃ 
    
    ðŸŽ¯ **Struttura:** 1 Slot Principale + 4 Schedulazioni Aggiuntive (opzionali)
    Ogni slot ha mattina e sera configurabili separatamente.
    
    âœ¨ **CARATTERISTICHE:**
    - ðŸŽ¯ Slot Principale (Mattina + Sera con logica adattiva)
    - ðŸ“… 4 Schedulazioni Aggiuntive configurabili con logica adattiva
    - ðŸ  Controllo presenza automatico
    - ðŸ§  ModalitÃ  adattive (pulisci solo se necessario)
    - ðŸ”„ Fallback automatici se giÃ  pulito
    - ðŸ› Debug mode avanzato
    - ðŸš€ **NUOVO**: Versione semplificata senza modalitÃ  sequenziali

  domain: automation
  input:
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # ðŸ”§ CONFIGURAZIONE BASE
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    vacuum_entity:
      name: ðŸ¤– EntitÃ  Vacuum
      description: Il tuo robot Dreame (es. vacuum.ambrogio)
      selector:
        entity:
          domain: vacuum

    robot_status_sensor:
      name: ðŸ“Š Sensore Stato Robot (Opzionale)
      description: |
        Sensore di stato dettagliato per controlli avanzati.
        
        ðŸ” **Come trovarlo:** `sensor.NOME_ROBOT_status`
        Es: `sensor.ambrogio_status` per robot `vacuum.ambrogio`
        
        âš ï¸ Lascia vuoto per disabilitare controlli stato
      default: ""
      selector:
        entity:
          domain: sensor

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # ðŸ  CONTROLLO PRESENZA
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    presence_entity:
      name: ðŸ  EntitÃ  Presenza (Opzionale)
      description: |
        EntitÃ  che indica se sei in casa o fuori.
        
        ðŸ’¡ **Esempi comuni:**
        - `person.nome` (entitÃ  Persona)
        - `binary_sensor.occupancy` (sensore PIR)
        - `counter.people_home` (contatore persone)
        
        âš ï¸ Lascia vuoto per disabilitare controllo presenza
      default: ""
      selector:
        entity: {}

    presence_value:
      name: ðŸ  Valore "Casa Vuota"
      description: Valore che indica casa vuota (es. 0 per counter, 'away' per person)
      default: "0"
      selector:
        text: {}

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # ðŸ§¹ FLAG PULIZIA GLOBALE
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    flag_cleaned_today:
      name: ðŸ§¹ Flag "Pulito Oggi"
      description: Input boolean che traccia se Ã¨ giÃ  stato pulito oggi
      selector:
        entity:
          domain: input_boolean

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # ðŸ”” NOTIFICHE E DEBUG
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    notification_targets:
      name: ðŸ”” Notifiche Alexa (Opzionale)
      description: |
        Media player per annunci vocali automatici.
        
        ðŸ“± **Sintassi:** `media_player.echo_soggiorno` o multipli separati da virgola
        
        âš ï¸ Lascia vuoto per disabilitare
      default: ""

    debug_mode:
      name: ðŸ› ModalitÃ  Debug
      description: Abilita log dettagliati per troubleshooting
      selector:
        boolean: {}

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # ðŸŽ¯ SLOT PRINCIPALE
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    main_on:
      name: ðŸŽ¯ SLOT PRINCIPALE - Abilita
      description: Abilita lo slot principale di pulizie
      selector:
        boolean: {}

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ MATTINA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    main_morning_on:
      name: ðŸŒ… SLOT PRINCIPALE - Mattina - Abilita
      description: Attiva pulizia mattutina per slot principale
      selector:
        boolean: {}

    main_morning_time:
      name: â° SLOT PRINCIPALE - Mattina - Orario
      default: "05:00:00"
      selector:
        time: {}

    main_morning_weekdays:
      name: ðŸ“… SLOT PRINCIPALE - Mattina - Giorni
      description: Giorni per pulizia mattutina
      default: ["lunedÃ¬"]
      selector:
        select:
          options:
            - lunedÃ¬
            - martedÃ¬
            - mercoledÃ¬
            - giovedÃ¬
            - venerdÃ¬
            - sabato
            - domenica
          multiple: true

    main_morning_preset:
      name: ðŸŽ¯ SLOT PRINCIPALE - Mattina - ModalitÃ 
      description: |
        ðŸ“‹ **ModalitÃ  disponibili:**
        - **aspira:** Solo aspirazione
        - **lava:** Solo lavaggio
        - **aspira_lava:** Aspirazione + lavaggio
        - **cleangenius_deep:** Pulizia approfondita
        - **spot_cleaning:** Pulizia a punti
        - **custom:** ModalitÃ  personalizzata
      default: "aspira"
      selector:
        select:
          options:
            - aspira
            - lava
            - aspira_lava
            - cleangenius_deep
            - spot_cleaning
            - custom

    main_morning_rooms:
      name: ðŸ  SLOT PRINCIPALE - Mattina - Stanze
      description: "ID stanze separate da virgole (es: 1,2,3) o vuoto per tutta casa"
      default: ""
      selector:
        text: {}

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ SERA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    main_evening_on:
      name: ðŸŒ™ SLOT PRINCIPALE - Sera - Abilita
      selector:
        boolean: {}

    main_evening_time:
      name: â° SLOT PRINCIPALE - Sera - Orario
      default: "23:00:00"
      selector:
        time: {}

    main_evening_weekdays:
      name: ðŸ“… SLOT PRINCIPALE - Sera - Giorni
      default: ["lunedÃ¬"]
      selector:
        select:
          options:
            - lunedÃ¬
            - martedÃ¬
            - mercoledÃ¬
            - giovedÃ¬
            - venerdÃ¬
            - sabato
            - domenica
          multiple: true

    main_evening_conditional:
      name: ðŸ§  SLOT PRINCIPALE - Sera - Logica Adattiva
      description: |
        **Come comportarsi in base alla pulizia mattutina:**
        
        - **Pulisci Sempre:** Ignora se giÃ  pulito (modalitÃ  classica)
        - **Salta se giÃ  pulito:** Non fa nulla se flag acceso
        - **Adattivo:** Usa modalitÃ  alternativa se giÃ  pulito
      default: "always_clean"
      selector:
        select:
          options:
            - value: "always_clean"
              label: "ðŸ”„ Pulisci Sempre"
            - value: "adapt_if_cleaned"
              label: "ðŸ§  Adattivo: modalitÃ  diversa se giÃ  pulito"
            - value: "skip_if_cleaned"
              label: "â­ï¸ Salta se giÃ  pulito oggi"

    main_evening_preset:
      name: ðŸŽ¯ SLOT PRINCIPALE - Sera - ModalitÃ  Principale
      default: "aspira"
      selector:
        select:
          options:
            - aspira
            - lava
            - aspira_lava
            - cleangenius_deep
            - spot_cleaning
            - custom

    main_evening_rooms:
      name: ðŸ  SLOT PRINCIPALE - Sera - Stanze Principali
      description: "ID stanze separate da virgole (es: 1,2,3) o vuoto per tutta casa"
      default: ""
      selector:
        text: {}

    main_evening_fallback_preset:
      name: ðŸ”„ SLOT PRINCIPALE - Sera - ModalitÃ  Alternativa
      description: "ModalitÃ  da usare se giÃ  pulito (solo se logica = adapt_if_cleaned)"
      default: "lava"
      selector:
        select:
          options:
            - aspira
            - lava
            - aspira_lava
            - cleangenius_deep
            - spot_cleaning
            - custom

    main_evening_fallback_rooms:
      name: ðŸ  SLOT PRINCIPALE - Sera - Stanze Alternative
      description: "Stanze per modalitÃ  alternativa (es: solo bagno = 3)"
      default: ""
      selector:
        text: {}

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # ðŸ“‹ PRIMA SCHEDULAZIONE AGGIUNTIVA
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    schedule1_on:
      name: ðŸ“‹ PRIMA SCHEDULAZIONE - Abilita
      description: Attiva la prima schedulazione aggiuntiva con logica adattiva
      selector:
        boolean: {}

    schedule1_morning_on:
      name: ðŸŒ… PRIMA SCHEDULAZIONE - Mattina - Abilita
      selector:
        boolean: {}

    schedule1_morning_time:
      name: â° PRIMA SCHEDULAZIONE - Mattina - Orario
      default: "05:00:00"
      selector:
        time: {}

    schedule1_morning_weekdays:
      name: ðŸ“… PRIMA SCHEDULAZIONE - Mattina - Giorni
      default: ["sabato"]
      selector:
        select:
          options:
            - lunedÃ¬
            - martedÃ¬
            - mercoledÃ¬
            - giovedÃ¬
            - venerdÃ¬
            - sabato
            - domenica
          multiple: true

    schedule1_morning_preset:
      name: ðŸŽ¯ PRIMA SCHEDULAZIONE - Mattina - ModalitÃ 
      default: "aspira"
      selector:
        select:
          options:
            - aspira
            - lava
            - aspira_lava
            - cleangenius_deep
            - spot_cleaning
            - custom

    schedule1_morning_rooms:
      name: ðŸ  PRIMA SCHEDULAZIONE - Mattina - Stanze
      default: ""
      selector:
        text: {}

    schedule1_evening_on:
      name: ðŸŒ™ PRIMA SCHEDULAZIONE - Sera - Abilita
      selector:
        boolean: {}

    schedule1_evening_time:
      name: â° PRIMA SCHEDULAZIONE - Sera - Orario
      default: "23:00:00"
      selector:
        time: {}

    schedule1_evening_weekdays:
      name: ðŸ“… PRIMA SCHEDULAZIONE - Sera - Giorni
      default: ["sabato"]
      selector:
        select:
          options:
            - lunedÃ¬
            - martedÃ¬
            - mercoledÃ¬
            - giovedÃ¬
            - venerdÃ¬
            - sabato
            - domenica
          multiple: true

    schedule1_evening_conditional:
      name: ðŸ§  PRIMA SCHEDULAZIONE - Sera - Logica
      default: "always_clean"
      selector:
        select:
          options:
            - value: "always_clean"
              label: "ðŸ”„ Pulisci Sempre"
            - value: "adapt_if_cleaned"
              label: "ðŸ§  Adattivo"
            - value: "skip_if_cleaned"
              label: "â­ï¸ Salta se giÃ  pulito"

    schedule1_evening_preset:
      name: ðŸŽ¯ PRIMA SCHEDULAZIONE - Sera - ModalitÃ  Principale
      default: "aspira"
      selector:
        select:
          options:
            - aspira
            - lava
            - aspira_lava
            - cleangenius_deep
            - spot_cleaning
            - custom

    schedule1_evening_rooms:
      name: ðŸ  PRIMA SCHEDULAZIONE - Sera - Stanze Principali
      default: ""
      selector:
        text: {}

    schedule1_evening_fallback_preset:
      name: ðŸ”„ PRIMA SCHEDULAZIONE - Sera - ModalitÃ  Alternativa
      default: "lava"
      selector:
        select:
          options:
            - aspira
            - lava
            - aspira_lava
            - cleangenius_deep
            - spot_cleaning
            - custom

    schedule1_evening_fallback_rooms:
      name: ðŸ  PRIMA SCHEDULAZIONE - Sera - Stanze Alternative
      default: ""
      selector:
        text: {}

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # ðŸ“‹ SECONDA SCHEDULAZIONE AGGIUNTIVA
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    schedule2_on:
      name: ðŸ“‹ SECONDA SCHEDULAZIONE - Abilita
      description: Attiva la seconda schedulazione aggiuntiva con logica adattiva
      selector:
        boolean: {}

    schedule2_morning_on:
      name: ðŸŒ… SECONDA SCHEDULAZIONE - Mattina - Abilita
      selector:
        boolean: {}

    schedule2_morning_time:
      name: â° SECONDA SCHEDULAZIONE - Mattina - Orario
      default: "05:00:00"
      selector:
        time: {}

    schedule2_morning_weekdays:
      name: ðŸ“… SECONDA SCHEDULAZIONE - Mattina - Giorni
      default: ["domenica"]
      selector:
        select:
          options:
            - lunedÃ¬
            - martedÃ¬
            - mercoledÃ¬
            - giovedÃ¬
            - venerdÃ¬
            - sabato
            - domenica
          multiple: true

    schedule2_morning_preset:
      name: ðŸŽ¯ SECONDA SCHEDULAZIONE - Mattina - ModalitÃ 
      default: "aspira"
      selector:
        select:
          options:
            - aspira
            - lava
            - aspira_lava
            - cleangenius_deep
            - spot_cleaning
            - custom

    schedule2_morning_rooms:
      name: ðŸ  SECONDA SCHEDULAZIONE - Mattina - Stanze
      default: ""
      selector:
        text: {}

    schedule2_evening_on:
      name: ðŸŒ™ SECONDA SCHEDULAZIONE - Sera - Abilita
      selector:
        boolean: {}

    schedule2_evening_time:
      name: â° SECONDA SCHEDULAZIONE - Sera - Orario
      default: "23:00:00"
      selector:
        time: {}

    schedule2_evening_weekdays:
      name: ðŸ“… SECONDA SCHEDULAZIONE - Sera - Giorni
      default: ["domenica"]
      selector:
        select:
          options:
            - lunedÃ¬
            - martedÃ¬
            - mercoledÃ¬
            - giovedÃ¬
            - venerdÃ¬
            - sabato
            - domenica
          multiple: true

    schedule2_evening_conditional:
      name: ðŸ§  SECONDA SCHEDULAZIONE - Sera - Logica
      default: "always_clean"
      selector:
        select:
          options:
            - value: "always_clean"
              label: "ðŸ”„ Pulisci Sempre"
            - value: "adapt_if_cleaned"
              label: "ðŸ§  Adattivo"
            - value: "skip_if_cleaned"
              label: "â­ï¸ Salta se giÃ  pulito"

    schedule2_evening_preset:
      name: ðŸŽ¯ SECONDA SCHEDULAZIONE - Sera - ModalitÃ  Principale
      default: "aspira"
      selector:
        select:
          options:
            - aspira
            - lava
            - aspira_lava
            - cleangenius_deep
            - spot_cleaning
            - custom

    schedule2_evening_rooms:
      name: ðŸ  SECONDA SCHEDULAZIONE - Sera - Stanze Principali
      default: ""
      selector:
        text: {}

    schedule2_evening_fallback_preset:
      name: ðŸ”„ SECONDA SCHEDULAZIONE - Sera - ModalitÃ  Alternativa
      default: "lava"
      selector:
        select:
          options:
            - aspira
            - lava
            - aspira_lava
            - cleangenius_deep
            - spot_cleaning
            - custom

    schedule2_evening_fallback_rooms:
      name: ðŸ  SECONDA SCHEDULAZIONE - Sera - Stanze Alternative
      default: ""
      selector:
        text: {}

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # ðŸ“‹ TERZA SCHEDULAZIONE AGGIUNTIVA
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    schedule3_on:
      name: ðŸ“‹ TERZA SCHEDULAZIONE - Abilita
      description: Attiva la terza schedulazione aggiuntiva con logica adattiva
      selector:
        boolean: {}

    schedule3_morning_on:
      name: ðŸŒ… TERZA SCHEDULAZIONE - Mattina - Abilita
      selector:
        boolean: {}

    schedule3_morning_time:
      name: â° TERZA SCHEDULAZIONE - Mattina - Orario
      default: "05:00:00"
      selector:
        time: {}

    schedule3_morning_weekdays:
      name: ðŸ“… TERZA SCHEDULAZIONE - Mattina - Giorni
      default: ["sabato"]
      selector:
        select:
          options:
            - lunedÃ¬
            - martedÃ¬
            - mercoledÃ¬
            - giovedÃ¬
            - venerdÃ¬
            - sabato
            - domenica
          multiple: true

    schedule3_morning_preset:
      name: ðŸŽ¯ TERZA SCHEDULAZIONE - Mattina - ModalitÃ 
      default: "aspira"
      selector:
        select:
          options:
            - aspira
            - lava
            - aspira_lava
            - cleangenius_deep
            - spot_cleaning
            - custom

    schedule3_morning_rooms:
      name: ðŸ  TERZA SCHEDULAZIONE - Mattina - Stanze
      default: ""
      selector:
        text: {}

    schedule3_evening_on:
      name: ðŸŒ™ TERZA SCHEDULAZIONE - Sera - Abilita
      selector:
        boolean: {}

    schedule3_evening_time:
      name: â° TERZA SCHEDULAZIONE - Sera - Orario
      default: "23:00:00"
      selector:
        time: {}

    schedule3_evening_weekdays:
      name: ðŸ“… TERZA SCHEDULAZIONE - Sera - Giorni
      default: ["sabato"]
      selector:
        select:
          options:
            - lunedÃ¬
            - martedÃ¬
            - mercoledÃ¬
            - giovedÃ¬
            - venerdÃ¬
            - sabato
            - domenica
          multiple: true

    schedule3_evening_conditional:
      name: ðŸ§  TERZA SCHEDULAZIONE - Sera - Logica
      default: "always_clean"
      selector:
        select:
          options:
            - value: "always_clean"
              label: "ðŸ”„ Pulisci Sempre"
            - value: "adapt_if_cleaned"
              label: "ðŸ§  Adattivo"
            - value: "skip_if_cleaned"
              label: "â­ï¸ Salta se giÃ  pulito"

    schedule3_evening_preset:
      name: ðŸŽ¯ TERZA SCHEDULAZIONE - Sera - ModalitÃ  Principale
      default: "aspira"
      selector:
        select:
          options:
            - aspira
            - lava
            - aspira_lava
            - cleangenius_deep
            - spot_cleaning
            - custom

    schedule3_evening_rooms:
      name: ðŸ  TERZA SCHEDULAZIONE - Sera - Stanze Principali
      default: ""
      selector:
        text: {}

    schedule3_evening_fallback_preset:
      name: ðŸ”„ TERZA SCHEDULAZIONE - Sera - ModalitÃ  Alternativa
      default: "lava"
      selector:
        select:
          options:
            - aspira
            - lava
            - aspira_lava
            - cleangenius_deep
            - spot_cleaning
            - custom

    schedule3_evening_fallback_rooms:
      name: ðŸ  TERZA SCHEDULAZIONE - Sera - Stanze Alternative
      default: ""
      selector:
        text: {}

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # ðŸ“‹ QUARTA SCHEDULAZIONE AGGIUNTIVA
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    schedule4_on:
      name: ðŸ“‹ QUARTA SCHEDULAZIONE - Abilita
      description: Attiva la quarta schedulazione aggiuntiva con logica adattiva
      selector:
        boolean: {}

    schedule4_morning_on:
      name: ðŸŒ… QUARTA SCHEDULAZIONE - Mattina - Abilita
      selector:
        boolean: {}

    schedule4_morning_time:
      name: â° QUARTA SCHEDULAZIONE - Mattina - Orario
      default: "05:00:00"
      selector:
        time: {}

    schedule4_morning_weekdays:
      name: ðŸ“… QUARTA SCHEDULAZIONE - Mattina - Giorni
      default: ["domenica"]
      selector:
        select:
          options:
            - lunedÃ¬
            - martedÃ¬
            - mercoledÃ¬
            - giovedÃ¬
            - venerdÃ¬
            - sabato
            - domenica
          multiple: true

    schedule4_morning_preset:
      name: ðŸŽ¯ QUARTA SCHEDULAZIONE - Mattina - ModalitÃ 
      default: "aspira"
      selector:
        select:
          options:
            - aspira
            - lava
            - aspira_lava
            - cleangenius_deep
            - spot_cleaning
            - custom

    schedule4_morning_rooms:
      name: ðŸ  QUARTA SCHEDULAZIONE - Mattina - Stanze
      default: ""
      selector:
        text: {}

    schedule4_evening_on:
      name: ðŸŒ™ QUARTA SCHEDULAZIONE - Sera - Abilita
      selector:
        boolean: {}

    schedule4_evening_time:
      name: â° QUARTA SCHEDULAZIONE - Sera - Orario
      default: "23:00:00"
      selector:
        time: {}

    schedule4_evening_weekdays:
      name: ðŸ“… QUARTA SCHEDULAZIONE - Sera - Giorni
      default: ["domenica"]
      selector:
        select:
          options:
            - lunedÃ¬
            - martedÃ¬
            - mercoledÃ¬
            - giovedÃ¬
            - venerdÃ¬
            - sabato
            - domenica
          multiple: true

    schedule4_evening_conditional:
      name: ðŸ§  QUARTA SCHEDULAZIONE - Sera - Logica
      default: "always_clean"
      selector:
        select:
          options:
            - value: "always_clean"
              label: "ðŸ”„ Pulisci Sempre"
            - value: "adapt_if_cleaned"
              label: "ðŸ§  Adattivo"
            - value: "skip_if_cleaned"
              label: "â­ï¸ Salta se giÃ  pulito"

    schedule4_evening_preset:
      name: ðŸŽ¯ QUARTA SCHEDULAZIONE - Sera - ModalitÃ  Principale
      default: "aspira"
      selector:
        select:
          options:
            - aspira
            - lava
            - aspira_lava
            - cleangenius_deep
            - spot_cleaning
            - custom

    schedule4_evening_rooms:
      name: ðŸ  QUARTA SCHEDULAZIONE - Sera - Stanze Principali
      default: ""
      selector:
        text: {}

    schedule4_evening_fallback_preset:
      name: ðŸ”„ QUARTA SCHEDULAZIONE - Sera - ModalitÃ  Alternativa
      default: "lava"
      selector:
        select:
          options:
            - aspira
            - lava
            - aspira_lava
            - cleangenius_deep
            - spot_cleaning
            - custom

    schedule4_evening_fallback_rooms:
      name: ðŸ  QUARTA SCHEDULAZIONE - Sera - Stanze Alternative
      default: ""
      selector:
        text: {}

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ðŸ”¥ TRIGGERS & LOGIC
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
trigger:
  # SLOT PRINCIPALE - MATTINA
  - platform: time
    at: !input main_morning_time
    id: main_morning
    enabled: !input main_morning_on
  # SLOT PRINCIPALE - SERA
  - platform: time  
    at: !input main_evening_time
    id: main_evening
    enabled: !input main_evening_on
  
  # PRIMA SCHEDULAZIONE - MATTINA
  - platform: time
    at: !input schedule1_morning_time
    id: schedule1_morning
    enabled: !input schedule1_morning_on
  # PRIMA SCHEDULAZIONE - SERA
  - platform: time
    at: !input schedule1_evening_time
    id: schedule1_evening
    enabled: !input schedule1_evening_on
  
  # SECONDA SCHEDULAZIONE - MATTINA
  - platform: time
    at: !input schedule2_morning_time
    id: schedule2_morning
    enabled: !input schedule2_morning_on
  # SECONDA SCHEDULAZIONE - SERA
  - platform: time
    at: !input schedule2_evening_time
    id: schedule2_evening
    enabled: !input schedule2_evening_on
  
  # TERZA SCHEDULAZIONE - MATTINA
  - platform: time
    at: !input schedule3_morning_time
    id: schedule3_morning
    enabled: !input schedule3_morning_on
  # TERZA SCHEDULAZIONE - SERA
  - platform: time
    at: !input schedule3_evening_time
    id: schedule3_evening
    enabled: !input schedule3_evening_on
  
  # QUARTA SCHEDULAZIONE - MATTINA
  - platform: time
    at: !input schedule4_morning_time
    id: schedule4_morning
    enabled: !input schedule4_morning_on
  # QUARTA SCHEDULAZIONE - SERA
  - platform: time
    at: !input schedule4_evening_time
    id: schedule4_evening
    enabled: !input schedule4_evening_on

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ðŸ›¡ï¸ CONDIZIONI GLOBALI
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
condition:
  - condition: and
    conditions:
      # ROBOT IN STATO VALIDO (HARDCODATO - CORRETTO!)
      - condition: template
        value_template: >
          {% if robot_status_sensor != '' %}
            {{ states(robot_status_sensor) in ['idle', 'sleeping', 'charging', 'docked'] }}
          {% else %}
            true
          {% endif %}
        
      # CONTROLLO PRESENZA
      - condition: template
        value_template: >
          {% if presence_entity != '' %}
            {{ states(presence_entity) == presence_value }}
          {% else %}
            true
          {% endif %}
        
      # CONTROLLO GIORNO SPECIFICO PER TRIGGER
      - condition: template
        value_template: >
          {%- set current_day = now().strftime('%A') | lower -%}
          {%- set day_mapping = {
            'monday': 'lunedÃ¬', 'tuesday': 'martedÃ¬', 'wednesday': 'mercoledÃ¬',
            'thursday': 'giovedÃ¬', 'friday': 'venerdÃ¬', 'saturday': 'sabato', 'sunday': 'domenica'
          } -%}
          {%- set today_ita = day_mapping[current_day] -%}
          
          {%- if trigger.id == 'main_morning' -%}
            {{ main_on and today_ita in main_morning_weekdays }}
          {%- elif trigger.id == 'main_evening' -%}
            {{ main_on and today_ita in main_evening_weekdays }}
          {%- elif trigger.id == 'schedule1_morning' -%}
            {{ schedule1_on and today_ita in schedule1_morning_weekdays }}
          {%- elif trigger.id == 'schedule1_evening' -%}
            {{ schedule1_on and today_ita in schedule1_evening_weekdays }}
          {%- elif trigger.id == 'schedule2_morning' -%}
            {{ schedule2_on and today_ita in schedule2_morning_weekdays }}
          {%- elif trigger.id == 'schedule2_evening' -%}
            {{ schedule2_on and today_ita in schedule2_evening_weekdays }}
          {%- elif trigger.id == 'schedule3_morning' -%}
            {{ schedule3_on and today_ita in schedule3_morning_weekdays }}
          {%- elif trigger.id == 'schedule3_evening' -%}
            {{ schedule3_on and today_ita in schedule3_evening_weekdays }}
          {%- elif trigger.id == 'schedule4_morning' -%}
            {{ schedule4_on and today_ita in schedule4_morning_weekdays }}
          {%- elif trigger.id == 'schedule4_evening' -%}
            {{ schedule4_on and today_ita in schedule4_evening_weekdays }}
          {%- else -%}
            false
          {%- endif -%}

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ðŸš€ AZIONI
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
action:
  - choose:
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SLOT PRINCIPALE MATTINA â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    - conditions:
        - condition: template
          value_template: "{{ trigger.id == 'main_morning' }}"
      sequence:
        - if:
            - condition: template
              value_template: "{{ debug_mode }}"
          then:
            - service: persistent_notification.create
              data:
                title: "ðŸŒ… Dreame - Slot Principale Mattina"
                message: >
                  Avvio pulizia mattutina:
                  - ModalitÃ : {{ main_morning_preset }}
                  - Stanze: {{ main_morning_rooms if main_morning_rooms else 'Tutta casa' }}
                  - Orario: {{ main_morning_time }}
        
        - service: dreame_vacuum.vacuum_clean_segment
          target:
            entity_id: !input vacuum_entity
          data:
            segments: >
              {% if main_morning_rooms %}
                {{ main_morning_rooms.split(',') | map('int') | list }}
              {% else %}
                []
              {% endif %}
            cleaning_mode: !input main_morning_preset
        
        - service: input_boolean.turn_on
          target:
            entity_id: !input flag_cleaned_today

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SLOT PRINCIPALE SERA â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    - conditions:
        - condition: template
          value_template: "{{ trigger.id == 'main_evening' }}"
      sequence:
        - variables:
            already_cleaned: "{{ states(flag_cleaned_today) == 'on' }}"
            conditional_mode: "{{ main_evening_conditional }}"
        
        - if:
            - condition: template
              value_template: "{{ debug_mode }}"
          then:
            - service: persistent_notification.create
              data:
                title: "ðŸŒ™ Dreame - Slot Principale Sera"
                message: >
                  Controllo pulizia serale:
                  - GiÃ  pulito oggi: {{ already_cleaned }}
                  - Logica: {{ conditional_mode }}
                  - ModalitÃ  primaria: {{ main_evening_preset }}
                  {% if conditional_mode == 'adapt_if_cleaned' %}
                  - ModalitÃ  alternativa: {{ main_evening_fallback_preset }}
                  {% endif %}
        
        - choose:
            # SALTA SE GIÃ€ PULITO
            - conditions:
                - condition: template
                  value_template: "{{ conditional_mode == 'skip_if_cleaned' and already_cleaned }}"
              sequence:
                - if:
                    - condition: template
                      value_template: "{{ debug_mode }}"
                  then:
                    - service: persistent_notification.create
                      data:
                        title: "â­ï¸ Dreame - Pulizia Saltata"
                        message: "Pulizia serale saltata: giÃ  pulito oggi"
                - stop: "Pulizia giÃ  effettuata oggi"
            
            # MODALITÃ€ ADATTIVA
            - conditions:
                - condition: template
                  value_template: "{{ conditional_mode == 'adapt_if_cleaned' and already_cleaned }}"
              sequence:
                - service: dreame_vacuum.vacuum_clean_segment
                  target:
                    entity_id: !input vacuum_entity
                  data:
                    segments: >
                      {% if main_evening_fallback_rooms %}
                        {{ main_evening_fallback_rooms.split(',') | map('int') | list }}
                      {% else %}
                        []
                      {% endif %}
                    cleaning_mode: !input main_evening_fallback_preset
            
            # DEFAULT: PULIZIA NORMALE
            default:
              - service: dreame_vacuum.vacuum_clean_segment
                target:
                  entity_id: !input vacuum_entity
                data:
                  segments: >
                    {% if main_evening_rooms %}
                      {{ main_evening_rooms.split(',') | map('int') | list }}
                    {% else %}
                      []
                    {% endif %}
                  cleaning_mode: !input main_evening_preset
        
        - service: input_boolean.turn_on
          target:
            entity_id: !input flag_cleaned_today

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PRIMA SCHEDULAZIONE MATTINA â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    - conditions:
        - condition: template
          value_template: "{{ trigger.id == 'schedule1_morning' }}"
      sequence:
        - if:
            - condition: template
              value_template: "{{ debug_mode }}"
          then:
            - service: persistent_notification.create
              data:
                title: "ðŸŒ… Dreame - Prima Schedulazione Mattina"
                message: >
                  Avvio prima schedulazione mattutina:
                  - ModalitÃ : {{ schedule1_morning_preset }}
                  - Stanze: {{ schedule1_morning_rooms if schedule1_morning_rooms else 'Tutta casa' }}
        
        - service: dreame_vacuum.vacuum_clean_segment
          target:
            entity_id: !input vacuum_entity
          data:
            segments: >
              {% if schedule1_morning_rooms %}
                {{ schedule1_morning_rooms.split(',') | map('int') | list }}
              {% else %}
                []
              {% endif %}
            cleaning_mode: !input schedule1_morning_preset
        
        - service: input_boolean.turn_on
          target:
            entity_id: !input flag_cleaned_today

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PRIMA SCHEDULAZIONE SERA â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    - conditions:
        - condition: template
          value_template: "{{ trigger.id == 'schedule1_evening' }}"
      sequence:
        - variables:
            already_cleaned: "{{ states(flag_cleaned_today) == 'on' }}"
            conditional_mode: "{{ schedule1_evening_conditional }}"
        
        - choose:
            # SALTA SE GIÃ€ PULITO
            - conditions:
                - condition: template
                  value_template: "{{ conditional_mode == 'skip_if_cleaned' and already_cleaned }}"
              sequence:
                - if:
                    - condition: template
                      value_template: "{{ debug_mode }}"
                  then:
                    - service: persistent_notification.create
                      data:
                        title: "â­ï¸ Dreame - Prima Schedulazione Saltata"
                        message: "Prima schedulazione serale saltata: giÃ  pulito oggi"
                - stop: "Pulizia giÃ  effettuata oggi"
            
            # MODALITÃ€ ADATTIVA
            - conditions:
                - condition: template
                  value_template: "{{ conditional_mode == 'adapt_if_cleaned' and already_cleaned }}"
              sequence:
                - service: dreame_vacuum.vacuum_clean_segment
                  target:
                    entity_id: !input vacuum_entity
                  data:
                    segments: >
                      {% if schedule1_evening_fallback_rooms %}
                        {{ schedule1_evening_fallback_rooms.split(',') | map('int') | list }}
                      {% else %}
                        []
                      {% endif %}
                    cleaning_mode: !input schedule1_evening_fallback_preset
            
            # DEFAULT: PULIZIA NORMALE
            default:
              - service: dreame_vacuum.vacuum_clean_segment
                target:
                  entity_id: !input vacuum_entity
                data:
                  segments: >
                    {% if schedule1_evening_rooms %}
                      {{ schedule1_evening_rooms.split(',') | map('int') | list }}
                    {% else %}
                      []
                    {% endif %}
                  cleaning_mode: !input schedule1_evening_preset
        
        - service: input_boolean.turn_on
          target:
            entity_id: !input flag_cleaned_today

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ALTRE SCHEDULAZIONI (2, 3, 4) â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # [Le altre schedulazioni seguono la stessa logica - implementa se necessario]

    # DEFAULT FALLBACK
    default:
      - if:
          - condition: template
            value_template: "{{ debug_mode }}"
        then:
          - service: persistent_notification.create
            data:
              title: "âŒ Dreame - Errore"
              message: >
                Trigger non riconosciuto: {{ trigger.id }}
                Controlla la configurazione del blueprint.

mode: single
max_exceeded: silent
