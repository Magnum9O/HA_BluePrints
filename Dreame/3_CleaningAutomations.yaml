blueprint:
  name: ğŸ¤– Dreame Vacuum - Automazione Pulizie Avanzata
  description: |
    ğŸš€ **SISTEMA INTELLIGENTE DI PULIZIE AUTOMATICHE**
    
    âœ¨ **CARATTERISTICHE:**
    - ğŸ¯ **Slot Principale**: Pulizie garantite senza logica adattiva
    - ğŸ“… **4 Schedulazioni Aggiuntive**: Con logica adattiva intelligente  
    - ğŸ§  **Controlli Automatici**: Verifica stato robot e presenza
    - ğŸ”„ **Logica Adattiva**: Evita pulizie ridondanti per le schedulazioni aggiuntive
    - ğŸ  **Configurazione Flessibile**: Ogni slot configurabile indipendentemente
    
    ğŸ“‹ **COME FUNZIONA:**
    - Lo **Slot Principale** esegue sempre le pulizie programmate
    - Le **Schedulazioni Aggiuntive** si adattano automaticamente
    - Ogni pulizia puÃ² avere modalitÃ , orari e giorni diversi
    - Sistema ottimizzato per evitare sprechi energetici

  domain: automation
  input:
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # ğŸ”§ CONFIGURAZIONE BASE
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    vacuum_entity:
      name: ğŸ¤– Robot Aspirapolvere
      description: Seleziona l'entitÃ  del robot aspirapolvere da controllare
      selector:
        entity:
          domain: vacuum

    robot_status_sensor:
      name: ğŸ“Š Sensore Stato Robot
      description: Sensore che riporta lo stato attuale del robot (idle, cleaning, etc.)
      selector:
        entity:
          domain: sensor

    presence_entity:
      name: ğŸ‘¥ Sensore di Presenza
      description: EntitÃ  che indica se qualcuno Ã¨ in casa (counter, person, etc.)
      selector:
        entity: {}

    presence_value:
      name: ğŸ  Valore "Casa Vuota"
      description: Valore che indica casa vuota (es. 0 per counter, 'away' per person)
      default: "0"
      selector:
        text: {}

    flag_cleaned_today:
      name: ğŸ Flag Pulizia Completata
      description: Input boolean che traccia se Ã¨ giÃ  stato pulito oggi (per logica adattiva)
      selector:
        entity:
          domain: input_boolean

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # ğŸ¯ SLOT PRINCIPALE (SEMPRE ATTIVO)
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    main_on:
      name: ğŸ¯ Abilita Slot Principale
      description: Attiva il programma principale di pulizia (sempre eseguito, senza logica adattiva)
      selector:
        boolean: {}

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ MATTINA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    main_morning_on:
      name: ğŸŒ… Slot Principale - Mattina - Abilita
      description: Attiva la pulizia mattutina del programma principale
      selector:
        boolean: {}

    main_morning_time:
      name: â° Slot Principale - Mattina - Orario
      description: Orario per la pulizia mattutina
      default: "05:00:00"
      selector:
        time: {}

    main_morning_weekdays:
      name: ğŸ“… Slot Principale - Mattina - Giorni
      description: Giorni della settimana per la pulizia mattutina
      selector:
        select:
          multiple: true
          mode: dropdown
          options:
            - lunedÃ¬
            - martedÃ¬
            - mercoledÃ¬
            - giovedÃ¬
            - venerdÃ¬
            - sabato
            - domenica

    main_morning_preset:
      name: ğŸ¯ Slot Principale - Mattina - ModalitÃ 
      description: ModalitÃ  di pulizia per il programma mattutino
      default: "aspira"
      selector:
        select:
          options:
            - aspira
            - lava
            - aspira_lava
            - cleangenius_deep
            - spot_cleaning
            - custom

    main_morning_rooms:
      name: ğŸ  Slot Principale - Mattina - Stanze
      description: "ID stanze separate da virgole (es: 1,2,3) o vuoto per tutta casa"
      default: ""
      selector:
        text: {}

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ SERA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    main_evening_on:
      name: ğŸŒ™ Slot Principale - Sera - Abilita
      description: Attiva la pulizia serale del programma principale
      selector:
        boolean: {}

    main_evening_time:
      name: â° Slot Principale - Sera - Orario
      description: Orario per la pulizia serale
      default: "23:00:00"
      selector:
        time: {}

    main_evening_weekdays:
      name: ğŸ“… Slot Principale - Sera - Giorni
      description: Giorni della settimana per la pulizia serale
      selector:
        select:
          multiple: true
          mode: dropdown
          options:
            - lunedÃ¬
            - martedÃ¬
            - mercoledÃ¬
            - giovedÃ¬
            - venerdÃ¬
            - sabato
            - domenica

    main_evening_conditional:
      name: ğŸ§  Slot Principale - Sera - Logica Adattiva
      description: Comportamento quando il robot Ã¨ giÃ  stato utilizzato oggi
      default: "always_clean"
      selector:
        select:
          options:
            - value: "always_clean"
              label: "ğŸ”„ Pulisci Sempre"
            - value: "adapt_if_cleaned"
              label: "ğŸ§  Adattivo: modalitÃ  diversa se giÃ  pulito"
            - value: "skip_if_cleaned"  
              label: "â­ï¸ Salta se giÃ  pulito oggi"

    main_evening_preset:
      name: ğŸ¯ Slot Principale - Sera - ModalitÃ  Principale
      description: ModalitÃ  di pulizia principale per il programma serale
      default: "aspira"
      selector:
        select:
          options:
            - aspira
            - lava
            - aspira_lava
            - cleangenius_deep
            - spot_cleaning
            - custom

    main_evening_rooms:
      name: ğŸ  Slot Principale - Sera - Stanze Principali
      description: "Stanze per modalitÃ  principale (es: 1,2,3) o vuoto per tutta casa"
      default: ""
      selector:
        text: {}

    main_evening_fallback_preset:
      name: ğŸ”„ Slot Principale - Sera - ModalitÃ  Alternativa
      description: "ModalitÃ  da usare se giÃ  pulito (solo se logica = adapt_if_cleaned)"
      default: "lava"
      selector:
        select:
          options:
            - aspira
            - lava
            - aspira_lava
            - cleangenius_deep
            - spot_cleaning
            - custom

    main_evening_fallback_rooms:
      name: ğŸ  Slot Principale - Sera - Stanze Alternative
      description: "Stanze per modalitÃ  alternativa (es: solo bagno = 3)"
      default: ""
      selector:
        text: {}

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # ğŸ“‹ SCHEDULAZIONE 1 (CON LOGICA ADATTIVA)
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    schedule1_on:
      name: ğŸ“‹ Abilita Prima Schedulazione
      description: Attiva la prima schedulazione aggiuntiva con logica adattiva (salta se giÃ  pulito di recente)
      selector:
        boolean: {}

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ MATTINA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    schedule1_morning_on:
      name: ğŸŒ… Prima Schedulazione - Mattina - Abilita
      description: Attiva la pulizia mattutina della prima schedulazione con logica adattiva
      selector:
        boolean: {}

    schedule1_morning_time:
      name: â° Prima Schedulazione - Mattina - Orario
      description: Orario per la pulizia mattutina della prima schedulazione
      default: "05:00:00"
      selector:
        time: {}

    schedule1_morning_weekdays:
      name: ğŸ“… Prima Schedulazione - Mattina - Giorni
      description: Giorni della settimana per la pulizia mattutina della prima schedulazione
      selector:
        select:
          multiple: true
          mode: dropdown
          options:
            - lunedÃ¬
            - martedÃ¬
            - mercoledÃ¬
            - giovedÃ¬
            - venerdÃ¬
            - sabato
            - domenica

    schedule1_morning_preset:
      name: ğŸ¯ Prima Schedulazione - Mattina - ModalitÃ 
      description: ModalitÃ  di pulizia per il programma mattutino della prima schedulazione
      default: "aspira"
      selector:
        select:
          options:
            - aspira
            - lava
            - aspira_lava
            - cleangenius_deep
            - spot_cleaning
            - custom

    schedule1_morning_rooms:
      name: ğŸ  Prima Schedulazione - Mattina - Stanze
      description: "ID stanze per mattina (es: 1,2,3) o vuoto per tutta casa"
      default: ""
      selector:
        text: {}

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ SERA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    schedule1_evening_on:
      name: ğŸŒ™ Prima Schedulazione - Sera - Abilita
      description: Attiva la pulizia serale della prima schedulazione con logica adattiva
      selector:
        boolean: {}

    schedule1_evening_time:
      name: â° Prima Schedulazione - Sera - Orario
      description: Orario per la pulizia serale della prima schedulazione
      default: "23:00:00"
      selector:
        time: {}

    schedule1_evening_weekdays:
      name: ğŸ“… Prima Schedulazione - Sera - Giorni
      description: Giorni della settimana per la pulizia serale della prima schedulazione
      selector:
        select:
          multiple: true
          mode: dropdown
          options:
            - lunedÃ¬
            - martedÃ¬
            - mercoledÃ¬
            - giovedÃ¬
            - venerdÃ¬
            - sabato
            - domenica

    schedule1_evening_conditional:
      name: ğŸ§  Prima Schedulazione - Sera - Logica Adattiva
      description: Comportamento quando il robot Ã¨ giÃ  stato utilizzato oggi
      default: "always_clean"
      selector:
        select:
          options:
            - value: "always_clean"
              label: "ğŸ”„ Pulisci Sempre"
            - value: "adapt_if_cleaned"
              label: "ğŸ§  Adattivo: modalitÃ  diversa se giÃ  pulito"
            - value: "skip_if_cleaned"
              label: "â­ï¸ Salta se giÃ  pulito oggi"

    schedule1_evening_preset:
      name: ğŸ¯ Prima Schedulazione - Sera - ModalitÃ  Principale
      description: ModalitÃ  di pulizia principale per il programma serale della prima schedulazione
      default: "aspira"
      selector:
        select:
          options:
            - aspira
            - lava
            - aspira_lava
            - cleangenius_deep
            - spot_cleaning
            - custom

    schedule1_evening_rooms:
      name: ğŸ  Prima Schedulazione - Sera - Stanze Principali
      description: "Stanze per modalitÃ  principale (es: 1,2,3) o vuoto per tutta casa"
      default: ""
      selector:
        text: {}

    schedule1_evening_fallback_preset:
      name: ğŸ”„ Prima Schedulazione - Sera - ModalitÃ  Alternativa
      description: "ModalitÃ  da usare se giÃ  pulito (solo se logica = adapt_if_cleaned)"
      default: "lava"
      selector:
        select:
          options:
            - aspira
            - lava
            - aspira_lava
            - cleangenius_deep
            - spot_cleaning
            - custom

    schedule1_evening_fallback_rooms:
      name: ğŸ  Prima Schedulazione - Sera - Stanze Alternative
      description: "Stanze per modalitÃ  alternativa (es: solo bagno = 3)"
      default: ""
      selector:
        text: {}

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # ğŸ“‹ SCHEDULAZIONE 2 (CON LOGICA ADATTIVA)
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    schedule2_on:
      name: ğŸ“‹ Abilita Seconda Schedulazione
      description: Attiva la seconda schedulazione aggiuntiva con logica adattiva (salta se giÃ  pulito di recente)
      selector:
        boolean: {}

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ MATTINA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    schedule2_morning_on:
      name: ğŸŒ… Seconda Schedulazione - Mattina - Abilita
      description: Attiva la pulizia mattutina della seconda schedulazione con logica adattiva
      selector:
        boolean: {}

    schedule2_morning_time:
      name: â° Seconda Schedulazione - Mattina - Orario
      description: Orario per la pulizia mattutina della seconda schedulazione
      default: "05:00:00"
      selector:
        time: {}

    schedule2_morning_weekdays:
      name: ğŸ“… Seconda Schedulazione - Mattina - Giorni
      description: Giorni della settimana per la pulizia mattutina della seconda schedulazione
      default: ["domenica"]
      selector:
        select:
          multiple: true
          mode: dropdown
          options:
            - lunedÃ¬
            - martedÃ¬
            - mercoledÃ¬
            - giovedÃ¬
            - venerdÃ¬
            - sabato
            - domenica

    schedule2_morning_preset:
      name: ğŸ¯ Seconda Schedulazione - Mattina - ModalitÃ 
      description: ModalitÃ  di pulizia per il programma mattutino della seconda schedulazione
      default: "aspira"
      selector:
        select:
          options:
            - aspira
            - lava
            - aspira_lava
            - cleangenius_deep
            - spot_cleaning
            - custom

    schedule2_morning_rooms:
      name: ğŸ  Seconda Schedulazione - Mattina - Stanze
      description: "ID stanze per mattina (es: 1,2,3) o vuoto per tutta casa"
      default: ""
      selector:
        text: {}

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ SERA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    schedule2_evening_on:
      name: ğŸŒ™ Seconda Schedulazione - Sera - Abilita
      description: Attiva la pulizia serale della seconda schedulazione con logica adattiva
      selector:
        boolean: {}

    schedule2_evening_time:
      name: â° Seconda Schedulazione - Sera - Orario
      description: Orario per la pulizia serale della seconda schedulazione
      default: "23:00:00"
      selector:
        time: {}

    schedule2_evening_weekdays:
      name: ğŸ“… Seconda Schedulazione - Sera - Giorni
      description: Giorni della settimana per la pulizia serale della seconda schedulazione
      selector:
        select:
          multiple: true
          mode: dropdown
          options:
            - lunedÃ¬
            - martedÃ¬
            - mercoledÃ¬
            - giovedÃ¬
            - venerdÃ¬
            - sabato
            - domenica

    schedule2_evening_conditional:
      name: ğŸ§  Seconda Schedulazione - Sera - Logica Adattiva
      description: Comportamento quando il robot Ã¨ giÃ  stato utilizzato oggi
      default: "always_clean"
      selector:
        select:
          options:
            - value: "always_clean"
              label: "ğŸ”„ Pulisci Sempre"
            - value: "adapt_if_cleaned"
              label: "ğŸ§  Adattivo: modalitÃ  diversa se giÃ  pulito"
            - value: "skip_if_cleaned"
              label: "â­ï¸ Salta se giÃ  pulito oggi"

    schedule2_evening_preset:
      name: ğŸ¯ Seconda Schedulazione - Sera - ModalitÃ  Principale
      description: ModalitÃ  di pulizia principale per il programma serale della seconda schedulazione
      default: "aspira"
      selector:
        select:
          options:
            - aspira
            - lava
            - aspira_lava
            - cleangenius_deep
            - spot_cleaning
            - custom

    schedule2_evening_rooms:
      name: ğŸ  Seconda Schedulazione - Sera - Stanze Principali
      description: "Stanze per modalitÃ  principale (es: 1,2,3) o vuoto per tutta casa"
      default: ""
      selector:
        text: {}

    schedule2_evening_fallback_preset:
      name: ğŸ”„ Seconda Schedulazione - Sera - ModalitÃ  Alternativa
      description: "ModalitÃ  da usare se giÃ  pulito (solo se logica = adapt_if_cleaned)"
      default: "lava"
      selector:
        select:
          options:
            - aspira
            - lava
            - aspira_lava
            - cleangenius_deep
            - spot_cleaning
            - custom

    schedule2_evening_fallback_rooms:
      name: ğŸ  Seconda Schedulazione - Sera - Stanze Alternative
      description: "Stanze per modalitÃ  alternativa (es: solo bagno = 3)"
      default: ""
      selector:
        text: {}

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # ğŸ“‹ SCHEDULAZIONE 3 (CON LOGICA ADATTIVA)
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    schedule3_on:
      name: ğŸ“‹ Abilita Terza Schedulazione
      description: Attiva la terza schedulazione aggiuntiva con logica adattiva (salta se giÃ  pulito di recente)
      selector:
        boolean: {}

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ MATTINA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    schedule3_morning_on:
      name: ğŸŒ… Terza Schedulazione - Mattina - Abilita
      description: Attiva la pulizia mattutina della terza schedulazione con logica adattiva
      selector:
        boolean: {}

    schedule3_morning_time:
      name: â° Terza Schedulazione - Mattina - Orario
      description: Orario per la pulizia mattutina della terza schedulazione
      default: "05:00:00"
      selector:
        time: {}

    schedule3_morning_weekdays:
      name: ğŸ“… Terza Schedulazione - Mattina - Giorni
      description: Giorni della settimana per la pulizia mattutina della terza schedulazione
      default: ["sabato"]
      selector:
        select:
          multiple: true
          mode: dropdown
          options:
            - lunedÃ¬
            - martedÃ¬
            - mercoledÃ¬
            - giovedÃ¬
            - venerdÃ¬
            - sabato
            - domenica

    schedule3_morning_preset:
      name: ğŸ¯ Terza Schedulazione - Mattina - ModalitÃ 
      description: ModalitÃ  di pulizia per il programma mattutino della terza schedulazione
      default: "aspira"
      selector:
        select:
          options:
            - aspira
            - lava
            - aspira_lava
            - cleangenius_deep
            - spot_cleaning
            - custom

    schedule3_morning_rooms:
      name: ğŸ  Terza Schedulazione - Mattina - Stanze
      description: "ID stanze per mattina (es: 1,2,3) o vuoto per tutta casa"
      default: ""
      selector:
        text: {}

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ SERA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    schedule3_evening_on:
      name: ğŸŒ™ Terza Schedulazione - Sera - Abilita
      description: Attiva la pulizia serale della terza schedulazione con logica adattiva
      selector:
        boolean: {}

    schedule3_evening_time:
      name: â° Terza Schedulazione - Sera - Orario
      description: Orario per la pulizia serale della terza schedulazione
      default: "23:00:00"
      selector:
        time: {}

    schedule3_evening_weekdays:
      name: ğŸ“… Terza Schedulazione - Sera - Giorni
      description: Giorni della settimana per la pulizia serale della terza schedulazione
      default: ["sabato"]
      selector:
        select:
          multiple: true
          mode: dropdown
          options:
            - lunedÃ¬
            - martedÃ¬
            - mercoledÃ¬
            - giovedÃ¬
            - venerdÃ¬
            - sabato
            - domenica

    schedule3_evening_conditional:
      name: ğŸ§  Terza Schedulazione - Sera - Logica Adattiva
      description: Comportamento quando il robot Ã¨ giÃ  stato utilizzato oggi
      default: "always_clean"
      selector:
        select:
          options:
            - value: "always_clean"
              label: "ğŸ”„ Pulisci Sempre"
            - value: "adapt_if_cleaned"
              label: "ğŸ§  Adattivo: modalitÃ  diversa se giÃ  pulito"
            - value: "skip_if_cleaned"
              label: "â­ï¸ Salta se giÃ  pulito oggi"

    schedule3_evening_preset:
      name: ğŸ¯ Terza Schedulazione - Sera - ModalitÃ  Principale
      description: ModalitÃ  di pulizia principale per il programma serale della terza schedulazione
      default: "aspira"
      selector:
        select:
          options:
            - aspira
            - lava
            - aspira_lava
            - cleangenius_deep
            - spot_cleaning
            - custom

    schedule3_evening_rooms:
      name: ğŸ  Terza Schedulazione - Sera - Stanze Principali
      description: "Stanze per modalitÃ  principale (es: 1,2,3) o vuoto per tutta casa"
      default: ""
      selector:
        text: {}

    schedule3_evening_fallback_preset:
      name: ğŸ”„ Terza Schedulazione - Sera - ModalitÃ  Alternativa
      description: "ModalitÃ  da usare se giÃ  pulito (solo se logica = adapt_if_cleaned)"
      default: "lava"
      selector:
        select:
          options:
            - aspira
            - lava
            - aspira_lava
            - cleangenius_deep
            - spot_cleaning
            - custom

    schedule3_evening_fallback_rooms:
      name: ğŸ  Terza Schedulazione - Sera - Stanze Alternative
      description: "Stanze per modalitÃ  alternativa (es: solo bagno = 3)"
      default: ""
      selector:
        text: {}

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # ğŸ“‹ SCHEDULAZIONE 4 (CON LOGICA ADATTIVA)
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    schedule4_on:
      name: ğŸ“‹ Abilita Quarta Schedulazione
      description: Attiva la quarta schedulazione aggiuntiva con logica adattiva (salta se giÃ  pulito di recente)
      selector:
        boolean: {}

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ MATTINA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    schedule4_morning_on:
      name: ğŸŒ… Quarta Schedulazione - Mattina - Abilita
      description: Attiva la pulizia mattutina della quarta schedulazione con logica adattiva
      selector:
        boolean: {}

    schedule4_morning_time:
      name: â° Quarta Schedulazione - Mattina - Orario
      description: Orario per la pulizia mattutina della quarta schedulazione
      default: "05:00:00"
      selector:
        time: {}

    schedule4_morning_weekdays:
      name: ğŸ“… Quarta Schedulazione - Mattina - Giorni
      description: Giorni della settimana per la pulizia mattutina della quarta schedulazione
      default: ["domenica"]
      selector:
        select:
          multiple: true
          mode: dropdown
          options:
            - lunedÃ¬
            - martedÃ¬
            - mercoledÃ¬
            - giovedÃ¬
            - venerdÃ¬
            - sabato
            - domenica

    schedule4_morning_preset:
      name: ğŸ¯ Quarta Schedulazione - Mattina - ModalitÃ 
      description: ModalitÃ  di pulizia per il programma mattutino della quarta schedulazione
      default: "aspira"
      selector:
        select:
          options:
            - aspira
            - lava
            - aspira_lava
            - cleangenius_deep
            - spot_cleaning
            - custom

    schedule4_morning_rooms:
      name: ğŸ  Quarta Schedulazione - Mattina - Stanze
      description: "ID stanze per mattina (es: 1,2,3) o vuoto per tutta casa"
      default: ""
      selector:
        text: {}

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ SERA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    schedule4_evening_on:
      name: ğŸŒ™ Quarta Schedulazione - Sera - Abilita
      description: Attiva la pulizia serale della quarta schedulazione con logica adattiva
      selector:
        boolean: {}

    schedule4_evening_time:
      name: â° Quarta Schedulazione - Sera - Orario
      description: Orario per la pulizia serale della quarta schedulazione
      default: "23:00:00"
      selector:
        time: {}

    schedule4_evening_weekdays:
      name: ğŸ“… Quarta Schedulazione - Sera - Giorni
      description: Giorni della settimana per la pulizia serale della quarta schedulazione
      default: ["domenica"]
      selector:
        select:
          multiple: true
          mode: dropdown
          options:
            - lunedÃ¬
            - martedÃ¬
            - mercoledÃ¬
            - giovedÃ¬
            - venerdÃ¬
            - sabato
            - domenica

    schedule4_evening_conditional:
      name: ğŸ§  Quarta Schedulazione - Sera - Logica Adattiva
      description: Comportamento quando il robot Ã¨ giÃ  stato utilizzato oggi
      default: "always_clean"
      selector:
        select:
          options:
            - value: "always_clean"
              label: "ğŸ”„ Pulisci Sempre"
            - value: "adapt_if_cleaned"
              label: "ğŸ§  Adattivo: modalitÃ  diversa se giÃ  pulito"
            - value: "skip_if_cleaned"
              label: "â­ï¸ Salta se giÃ  pulito oggi"

    schedule4_evening_preset:
      name: ğŸ¯ Quarta Schedulazione - Sera - ModalitÃ  Principale
      description: ModalitÃ  di pulizia principale per il programma serale della quarta schedulazione
      default: "aspira"
      selector:
        select:
          options:
            - aspira
            - lava
            - aspira_lava
            - cleangenius_deep
            - spot_cleaning
            - custom

    schedule4_evening_rooms:
      name: ğŸ  Quarta Schedulazione - Sera - Stanze Principali
      description: "Stanze per modalitÃ  principale (es: 1,2,3) o vuoto per tutta casa"
      default: ""
      selector:
        text: {}

    schedule4_evening_fallback_preset:
      name: ğŸ”„ Quarta Schedulazione - Sera - ModalitÃ  Alternativa
      description: "ModalitÃ  da usare se giÃ  pulito (solo se logica = adapt_if_cleaned)"
      default: "lava"
      selector:
        select:
          options:
            - aspira
            - lava
            - aspira_lava
            - cleangenius_deep
            - spot_cleaning
            - custom

    schedule4_evening_fallback_rooms:
      name: ğŸ  Quarta Schedulazione - Sera - Stanze Alternative
      description: "Stanze per modalitÃ  alternativa (es: solo bagno = 3)"
      default: ""
      selector:
        text: {}

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # ğŸ› DEBUG
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    debug_mode:
      name: ğŸ› ModalitÃ  Debug
      description: Abilita notifiche dettagliate per troubleshooting e monitoraggio
      selector:
        boolean: {}

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ”¥ VARIABILI GLOBALI
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
variables:
  robot_status: !input robot_status_sensor
  vacuum_ent: !input vacuum_entity
  presence_ent: !input presence_entity
  pres_val: !input presence_value
  flag_ent: !input flag_cleaned_today
  debug_enabled: !input debug_mode

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# âš¡ TRIGGER SYSTEM
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
trigger:
  # SLOT PRINCIPALE
  - platform: time
    at: !input main_morning_time
    id: main_morning
  - platform: time
    at: !input main_evening_time
    id: main_evening
    
  # PRIMA SCHEDULAZIONE
  - platform: time
    at: !input schedule1_morning_time
    id: schedule1_morning
  - platform: time
    at: !input schedule1_evening_time
    id: schedule1_evening
    
  # SECONDA SCHEDULAZIONE
  - platform: time
    at: !input schedule2_morning_time
    id: schedule2_morning
  - platform: time
    at: !input schedule2_evening_time
    id: schedule2_evening
    
  # TERZA SCHEDULAZIONE
  - platform: time
    at: !input schedule3_morning_time
    id: schedule3_morning
  - platform: time
    at: !input schedule3_evening_time
    id: schedule3_evening
    
  # QUARTA SCHEDULAZIONE
  - platform: time
    at: !input schedule4_morning_time
    id: schedule4_morning
  - platform: time
    at: !input schedule4_evening_time
    id: schedule4_evening

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ›¡ï¸ CONDIZIONI GLOBALI
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
condition:
  - condition: and
    conditions:
      # CONTROLLO STATO ROBOT (HARDCODATO - CORRETTO!)
      - condition: template
        value_template: >
          {{ states(robot_status) in ['idle', 'sleeping', 'charging', 'docked'] }}
      
      # CONTROLLO PRESENZA
      - condition: template
        value_template: >
          {{ states(presence_ent) == pres_val }}
      
      # CONTROLLO GIORNO APPROPRIATO
      - condition: template
        value_template: >
          {%- set current_day = now().strftime('%A') | lower -%}
          {%- set day_mapping = {
            'monday': 'lunedÃ¬', 'tuesday': 'martedÃ¬', 'wednesday': 'mercoledÃ¬',
            'thursday': 'giovedÃ¬', 'friday': 'venerdÃ¬', 'saturday': 'sabato', 'sunday': 'domenica'
          } -%}
          {%- set today_ita = day_mapping[current_day] -%}
          
          {%- if trigger.id == 'main_morning' -%}
            {{ main_on and main_morning_on and today_ita in main_morning_weekdays }}
          {%- elif trigger.id == 'main_evening' -%}
            {{ main_on and main_evening_on and today_ita in main_evening_weekdays }}
          {%- elif trigger.id == 'schedule1_morning' -%}
            {{ schedule1_on and schedule1_morning_on and today_ita in schedule1_morning_weekdays }}
          {%- elif trigger.id == 'schedule1_evening' -%}
            {{ schedule1_on and schedule1_evening_on and today_ita in schedule1_evening_weekdays }}
          {%- elif trigger.id == 'schedule2_morning' -%}
            {{ schedule2_on and schedule2_morning_on and today_ita in schedule2_morning_weekdays }}
          {%- elif trigger.id == 'schedule2_evening' -%}
            {{ schedule2_on and schedule2_evening_on and today_ita in schedule2_evening_weekdays }}
          {%- elif trigger.id == 'schedule3_morning' -%}
            {{ schedule3_on and schedule3_morning_on and today_ita in schedule3_morning_weekdays }}
          {%- elif trigger.id == 'schedule3_evening' -%}
            {{ schedule3_on and schedule3_evening_on and today_ita in schedule3_evening_weekdays }}
          {%- elif trigger.id == 'schedule4_morning' -%}
            {{ schedule4_on and schedule4_morning_on and today_ita in schedule4_morning_weekdays }}
          {%- elif trigger.id == 'schedule4_evening' -%}
            {{ schedule4_on and schedule4_evening_on and today_ita in schedule4_evening_weekdays }}
          {%- else -%}
            false
          {%- endif -%}

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸš€ SISTEMA DI ESECUZIONE
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
action:
  - choose:
      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SLOT PRINCIPALE MATTINA â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      - conditions:
          - condition: template
            value_template: "{{ trigger.id == 'main_morning' }}"
        sequence:
          - if:
              - condition: template
                value_template: "{{ debug_enabled }}"
            then:
              - service: persistent_notification.create
                data:
                  title: "ğŸŒ… Dreame - Slot Principale Mattina"
                  message: >
                    Avvio pulizia mattutina:
                    - ModalitÃ : {{ main_morning_preset }}
                    - Stanze: {{ main_morning_rooms if main_morning_rooms else 'Tutta casa' }}
                    - Orario: {{ main_morning_time }}
          
          - service: dreame_vacuum.vacuum_clean_segment
            target:
              entity_id: "{{ vacuum_ent }}"
            data:
              segments: >
                {% if main_morning_rooms %}
                  {{ main_morning_rooms.split(',') | map('int') | list }}
                {% else %}
                  []
                {% endif %}
              cleaning_mode: "{{ main_morning_preset }}"

          - service: input_boolean.turn_on
            target:
              entity_id: "{{ flag_ent }}"

      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SLOT PRINCIPALE SERA â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      - conditions:
          - condition: template
            value_template: "{{ trigger.id == 'main_evening' }}"
        sequence:
          - variables:
              already_cleaned: "{{ states(flag_ent) == 'on' }}"
              conditional_mode: "{{ main_evening_conditional }}"
              
          - if:
              - condition: template
                value_template: "{{ debug_enabled }}"
            then:
              - service: persistent_notification.create
                data:
                  title: "ğŸŒ™ Dreame - Slot Principale Sera"
                  message: >
                    Controllo pulizia serale:
                    - GiÃ  pulito oggi: {{ already_cleaned }}
                    - Logica: {{ conditional_mode }}
                    - ModalitÃ  primaria: {{ main_evening_preset }}
                    {% if conditional_mode == 'adapt_if_cleaned' %}
                    - ModalitÃ  alternativa: {{ main_evening_fallback_preset }}
                    {% endif %}

          - choose:
              # SALTA SE GIÃ€ PULITO
              - conditions:
                  - condition: template
                    value_template: "{{ conditional_mode == 'skip_if_cleaned' and already_cleaned }}"
                sequence:
                  - if:
                      - condition: template
                        value_template: "{{ debug_enabled }}"
                    then:
                      - service: persistent_notification.create
                        data:
                          title: "â­ï¸ Dreame - Pulizia Saltata"
                          message: "Pulizia serale saltata: giÃ  pulito oggi"

              # MODALITÃ€ ADATTIVA
              - conditions:
                  - condition: template
                    value_template: "{{ conditional_mode == 'adapt_if_cleaned' and already_cleaned }}"
                sequence:
                  - service: dreame_vacuum.vacuum_clean_segment
                    target:
                      entity_id: "{{ vacuum_ent }}"
                    data:
                      segments: >
                        {% if main_evening_fallback_rooms %}
                          {{ main_evening_fallback_rooms.split(',') | map('int') | list }}
                        {% else %}
                          []
                        {% endif %}
                      cleaning_mode: "{{ main_evening_fallback_preset }}"

            # DEFAULT: PULIZIA NORMALE
            default:
              - service: dreame_vacuum.vacuum_clean_segment
                target:
                  entity_id: "{{ vacuum_ent }}"
                data:
                  segments: >
                    {% if main_evening_rooms %}
                      {{ main_evening_rooms.split(',') | map('int') | list }}
                    {% else %}
                      []
                    {% endif %}
                  cleaning_mode: "{{ main_evening_preset }}"

              - service: input_boolean.turn_on
                target:
                  entity_id: "{{ flag_ent }}"

      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PRIMA SCHEDULAZIONE MATTINA â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      - conditions:
          - condition: template
            value_template: "{{ trigger.id == 'schedule1_morning' }}"
        sequence:
          - if:
              - condition: template
                value_template: "{{ debug_enabled }}"
            then:
              - service: persistent_notification.create
                data:
                  title: "ğŸŒ… Dreame - Prima Schedulazione Mattina"
                  message: >
                    Avvio prima schedulazione mattutina:
                    - ModalitÃ : {{ schedule1_morning_preset }}
                    - Stanze: {{ schedule1_morning_rooms if schedule1_morning_rooms else 'Tutta casa' }}
          
          - service: dreame_vacuum.vacuum_clean_segment
            target:
              entity_id: "{{ vacuum_ent }}"
            data:
              segments: >
                {% if schedule1_morning_rooms %}
                  {{ schedule1_morning_rooms.split(',') | map('int') | list }}
                {% else %}
                  []
                {% endif %}
              cleaning_mode: "{{ schedule1_morning_preset }}"

          - service: input_boolean.turn_on
            target:
              entity_id: "{{ flag_ent }}"

      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PRIMA SCHEDULAZIONE SERA â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      - conditions:
          - condition: template
            value_template: "{{ trigger.id == 'schedule1_evening' }}"
        sequence:
          - variables:
              already_cleaned: "{{ states(flag_ent) == 'on' }}"
              conditional_mode: "{{ schedule1_evening_conditional }}"
              
          - choose:
              - conditions:
                  - condition: template
                    value_template: "{{ conditional_mode == 'skip_if_cleaned' and already_cleaned }}"
                sequence:
                  - if:
                      - condition: template
                        value_template: "{{ debug_enabled }}"
                    then:
                      - service: persistent_notification.create
                        data:
                          title: "â­ï¸ Dreame - Prima Schedulazione Saltata"
                          message: "Prima schedulazione serale saltata: giÃ  pulito oggi"

              - conditions:
                  - condition: template
                    value_template: "{{ conditional_mode == 'adapt_if_cleaned' and already_cleaned }}"
                sequence:
                  - service: dreame_vacuum.vacuum_clean_segment
                    target:
                      entity_id: "{{ vacuum_ent }}"
                    data:
                      segments: >
                        {% if schedule1_evening_fallback_rooms %}
                          {{ schedule1_evening_fallback_rooms.split(',') | map('int') | list }}
                        {% else %}
                          []
                        {% endif %}
                      cleaning_mode: "{{ schedule1_evening_fallback_preset }}"

            default:
              - service: dreame_vacuum.vacuum_clean_segment
                target:
                  entity_id: "{{ vacuum_ent }}"
                data:
                  segments: >
                    {% if schedule1_evening_rooms %}
                      {{ schedule1_evening_rooms.split(',') | map('int') | list }}
                    {% else %}
                      []
                    {% endif %}
                  cleaning_mode: "{{ schedule1_evening_preset }}"

              - service: input_boolean.turn_on
                target:
                  entity_id: "{{ flag_ent }}"

      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SECONDA SCHEDULAZIONE MATTINA â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      - conditions:
          - condition: template
            value_template: "{{ trigger.id == 'schedule2_morning' }}"
        sequence:
          - if:
              - condition: template
                value_template: "{{ debug_enabled }}"
            then:
              - service: persistent_notification.create
                data:
                  title: "ğŸŒ… Dreame - Seconda Schedulazione Mattina"
                  message: >
                    Avvio seconda schedulazione mattutina:
                    - ModalitÃ : {{ schedule2_morning_preset }}
                    - Stanze: {{ schedule2_morning_rooms if schedule2_morning_rooms else 'Tutta casa' }}
          
          - service: dreame_vacuum.vacuum_clean_segment
            target:
              entity_id: "{{ vacuum_ent }}"
            data:
              segments: >
                {% if schedule2_morning_rooms %}
                  {{ schedule2_morning_rooms.split(',') | map('int') | list }}
                {% else %}
                  []
                {% endif %}
              cleaning_mode: "{{ schedule2_morning_preset }}"

          - service: input_boolean.turn_on
            target:
              entity_id: "{{ flag_ent }}"

      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SECONDA SCHEDULAZIONE SERA â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      - conditions:
          - condition: template
            value_template: "{{ trigger.id == 'schedule2_evening' }}"
        sequence:
          - variables:
              already_cleaned: "{{ states(flag_ent) == 'on' }}"
              conditional_mode: "{{ schedule2_evening_conditional }}"
              
          - choose:
              - conditions:
                  - condition: template
                    value_template: "{{ conditional_mode == 'skip_if_cleaned' and already_cleaned }}"
                sequence:
                  - if:
                      - condition: template
                        value_template: "{{ debug_enabled }}"
                    then:
                      - service: persistent_notification.create
                        data:
                          title: "â­ï¸ Dreame - Seconda Schedulazione Saltata"
                          message: "Seconda schedulazione serale saltata: giÃ  pulito oggi"

              - conditions:
                  - condition: template
                    value_template: "{{ conditional_mode == 'adapt_if_cleaned' and already_cleaned }}"
                sequence:
                  - service: dreame_vacuum.vacuum_clean_segment
                    target:
                      entity_id: "{{ vacuum_ent }}"
                    data:
                      segments: >
                        {% if schedule2_evening_fallback_rooms %}
                          {{ schedule2_evening_fallback_rooms.split(',') | map('int') | list }}
                        {% else %}
                          []
                        {% endif %}
                      cleaning_mode: "{{ schedule2_evening_fallback_preset }}"

            default:
              - service: dreame_vacuum.vacuum_clean_segment
                target:
                  entity_id: "{{ vacuum_ent }}"
                data:
                  segments: >
                    {% if schedule2_evening_rooms %}
                      {{ schedule2_evening_rooms.split(',') | map('int') | list }}
                    {% else %}
                      []
                    {% endif %}
                  cleaning_mode: "{{ schedule2_evening_preset }}"

              - service: input_boolean.turn_on
                target:
                  entity_id: "{{ flag_ent }}"

      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TERZA SCHEDULAZIONE MATTINA â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      - conditions:
          - condition: template
            value_template: "{{ trigger.id == 'schedule3_morning' }}"
        sequence:
          - if:
              - condition: template
                value_template: "{{ debug_enabled }}"
            then:
              - service: persistent_notification.create
                data:
                  title: "ğŸŒ… Dreame - Terza Schedulazione Mattina"
                  message: >
                    Avvio terza schedulazione mattutina:
                    - ModalitÃ : {{ schedule3_morning_preset }}
                    - Stanze: {{ schedule3_morning_rooms if schedule3_morning_rooms else 'Tutta casa' }}
          
          - service: dreame_vacuum.vacuum_clean_segment
            target:
              entity_id: "{{ vacuum_ent }}"
            data:
              segments: >
                {% if schedule3_morning_rooms %}
                  {{ schedule3_morning_rooms.split(',') | map('int') | list }}
                {% else %}
                  []
                {% endif %}
              cleaning_mode: "{{ schedule3_morning_preset }}"

          - service: input_boolean.turn_on
            target:
              entity_id: "{{ flag_ent }}"

      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TERZA SCHEDULAZIONE SERA â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      - conditions:
          - condition: template
            value_template: "{{ trigger.id == 'schedule3_evening' }}"
        sequence:
          - variables:
              already_cleaned: "{{ states(flag_ent) == 'on' }}"
              conditional_mode: "{{ schedule3_evening_conditional }}"
              
          - choose:
              - conditions:
                  - condition: template
                    value_template: "{{ conditional_mode == 'skip_if_cleaned' and already_cleaned }}"
                sequence:
                  - if:
                      - condition: template
                        value_template: "{{ debug_enabled }}"
                    then:
                      - service: persistent_notification.create
                        data:
                          title: "â­ï¸ Dreame - Terza Schedulazione Saltata"
                          message: "Terza schedulazione serale saltata: giÃ  pulito oggi"

              - conditions:
                  - condition: template
                    value_template: "{{ conditional_mode == 'adapt_if_cleaned' and already_cleaned }}"
                sequence:
                  - service: dreame_vacuum.vacuum_clean_segment
                    target:
                      entity_id: "{{ vacuum_ent }}"
                    data:
                      segments: >
                        {% if schedule3_evening_fallback_rooms %}
                          {{ schedule3_evening_fallback_rooms.split(',') | map('int') | list }}
                        {% else %}
                          []
                        {% endif %}
                      cleaning_mode: "{{ schedule3_evening_fallback_preset }}"

            default:
              - service: dreame_vacuum.vacuum_clean_segment
                target:
                  entity_id: "{{ vacuum_ent }}"
                data:
                  segments: >
                    {% if schedule3_evening_rooms %}
                      {{ schedule3_evening_rooms.split(',') | map('int') | list }}
                    {% else %}
                      []
                    {% endif %}
                  cleaning_mode: "{{ schedule3_evening_preset }}"

              - service: input_boolean.turn_on
                target:
                  entity_id: "{{ flag_ent }}"

      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• QUARTA SCHEDULAZIONE MATTINA â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      - conditions:
          - condition: template
            value_template: "{{ trigger.id == 'schedule4_morning' }}"
        sequence:
          - if:
              - condition: template
                value_template: "{{ debug_enabled }}"
            then:
              - service: persistent_notification.create
                data:
                  title: "ğŸŒ… Dreame - Quarta Schedulazione Mattina"
                  message: >
                    Avvio quarta schedulazione mattutina:
                    - ModalitÃ : {{ schedule4_morning_preset }}
                    - Stanze: {{ schedule4_morning_rooms if schedule4_morning_rooms else 'Tutta casa' }}
          
          - service: dreame_vacuum.vacuum_clean_segment
            target:
              entity_id: "{{ vacuum_ent }}"
            data:
              segments: >
                {% if schedule4_morning_rooms %}
                  {{ schedule4_morning_rooms.split(',') | map('int') | list }}
                {% else %}
                  []
                {% endif %}
              cleaning_mode: "{{ schedule4_morning_preset }}"

          - service: input_boolean.turn_on
            target:
              entity_id: "{{ flag_ent }}"

      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• QUARTA SCHEDULAZIONE SERA â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      - conditions:
          - condition: template
            value_template: "{{ trigger.id == 'schedule4_evening' }}"
        sequence:
          - variables:
              already_cleaned: "{{ states(flag_ent) == 'on' }}"
              conditional_mode: "{{ schedule4_evening_conditional }}"
              
          - choose:
              - conditions:
                  - condition: template
                    value_template: "{{ conditional_mode == 'skip_if_cleaned' and already_cleaned }}"
                sequence:
                  - if:
                      - condition: template
                        value_template: "{{ debug_enabled }}"
                    then:
                      - service: persistent_notification.create
                        data:
                          title: "â­ï¸ Dreame - Quarta Schedulazione Saltata"
                          message: "Quarta schedulazione serale saltata: giÃ  pulito oggi"

              - conditions:
                  - condition: template
                    value_template: "{{ conditional_mode == 'adapt_if_cleaned' and already_cleaned }}"
                sequence:
                  - service: dreame_vacuum.vacuum_clean_segment
                    target:
                      entity_id: "{{ vacuum_ent }}"
                    data:
                      segments: >
                        {% if schedule4_evening_fallback_rooms %}
                          {{ schedule4_evening_fallback_rooms.split(',') | map('int') | list }}
                        {% else %}
                          []
                        {% endif %}
                      cleaning_mode: "{{ schedule4_evening_fallback_preset }}"

            default:
              - service: dreame_vacuum.vacuum_clean_segment
                target:
                  entity_id: "{{ vacuum_ent }}"
                data:
                  segments: >
                    {% if schedule4_evening_rooms %}
                      {{ schedule4_evening_rooms.split(',') | map('int') | list }}
                    {% else %}
                      []
                    {% endif %}
                  cleaning_mode: "{{ schedule4_evening_preset }}"

              - service: input_boolean.turn_on
                target:
                  entity_id: "{{ flag_ent }}"

    # FALLBACK PER ERRORI
    default:
      - if:
          - condition: template
            value_template: "{{ debug_enabled }}"
        then:
          - service: persistent_notification.create
            data:
              title: "âŒ Dreame - Errore"
              message: >
                Trigger non riconosciuto: {{ trigger.id }}
                Controlla la configurazione del blueprint.

mode: queued
max: 10
