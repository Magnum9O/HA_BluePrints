blueprint:
  name: ğŸ¤– [DEV 2.1] Dreame Vacuum - Automazione Pulizie Avanzata
  description: |
    ğŸš€ **SISTEMA DI PULIZIE INTELLIGENTE PER DREAME**
    
    âœ¨ **CARATTERISTICHE PRINCIPALI:**
    - ğŸ¯ **Slot Principale**: Pulizie programmate senza logica adattiva (sempre eseguite)
    - ğŸ“… **4 Schedulazioni Aggiuntive**: Con logica adattiva intelligente che evita pulizie ridondanti
    - ğŸ§  **Multi-Step Cleaning**: Fino a 3 passaggi configurabili per ogni sessione
    - ğŸ”„ **Logica Adattiva Avanzata**: Salta automaticamente le pulizie se giÃ  effettuate di recente
    - ğŸ  **Controlli Intelligenti**: Verifica stato robot e presenza automaticamente
    - ğŸ”§ **FlessibilitÃ  Totale**: Ogni schedulazione configurabile indipendentemente
    
    ğŸ“‹ **UTILIZZO:**
    - Lo **Slot Principale** Ã¨ ideale per pulizie quotidiane garantite
    - Le **Schedulazioni Aggiuntive** si adattano automaticamente per ottimizzare l'uso del robot
    - Configura orari e giorni diversi per ogni tipo di pulizia
    - Il sistema evita sovrapposizioni e sprechi energetici

  domain: automation
  input:
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # ğŸ”§ CONFIGURAZIONE BASE
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    vacuum_entity:
      name: ğŸ¤– Robot Aspirapolvere
      description: Seleziona l'entitÃ  del robot aspirapolvere da controllare
      selector:
        entity:
          domain: vacuum

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # ğŸ¯ SLOT PRINCIPALE (SEMPRE ATTIVO)
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    main_schedule_enabled:
      name: ğŸ¯ Abilita Slot Principale
      description: Attiva il programma principale di pulizia (sempre eseguito, senza logica adattiva)
      selector:
        boolean: {}

    main_evening_time:
      name: â° Slot Principale - Orario Serale
      description: Orario per la pulizia serale del programma principale
      default: "23:00:00"
      selector:
        time: {}

    main_morning_time:
      name: â° Slot Principale - Orario Mattutino
      description: Orario per la pulizia mattutina del programma principale
      default: "05:00:00"
      selector:
        time: {}

    main_evening_weekdays:
      name: ğŸ“… Slot Principale - Giorni Serali
      description: Giorni della settimana per pulizia serale del programma principale
      selector:
        select:
          multiple: true
          mode: dropdown
          options:
            - lunedÃ¬
            - martedÃ¬
            - mercoledÃ¬
            - giovedÃ¬
            - venerdÃ¬
            - sabato
            - domenica

    main_morning_weekdays:
      name: ğŸ“… Slot Principale - Giorni Mattutini
      description: Giorni della settimana per pulizia mattutina del programma principale
      selector:
        select:
          multiple: true
          mode: dropdown
          options:
            - lunedÃ¬
            - martedÃ¬
            - mercoledÃ¬
            - giovedÃ¬
            - venerdÃ¬
            - sabato
            - domenica

    main_evening_preset:
      name: ğŸ¯ Slot Principale - Sera - Preset Step 1
      description: ModalitÃ  di pulizia per il primo passaggio del programma serale principale
      default: "aspira"
      selector:
        select:
          options:
            - aspira
            - cleangenius_deep
            - cleangenius_fast
            - custom_cleaning

    main_morning_preset:
      name: ğŸ¯ Slot Principale - Mattina - Preset Step 1
      description: ModalitÃ  di pulizia per il primo passaggio del programma mattutino principale
      default: "aspira"
      selector:
        select:
          options:
            - aspira
            - cleangenius_deep
            - cleangenius_fast
            - custom_cleaning

    main_evening_step2_preset:
      name: ğŸ¯ Slot Principale - Sera - Preset Step 2
      description: ModalitÃ  di pulizia per il secondo passaggio (se abilitato)
      default: "cleangenius_deep"
      selector:
        select:
          options:
            - aspira
            - cleangenius_deep
            - cleangenius_fast
            - custom_cleaning

    main_morning_step2_preset:
      name: ğŸ¯ Slot Principale - Mattina - Preset Step 2
      description: ModalitÃ  di pulizia per il secondo passaggio (se abilitato)
      default: "cleangenius_deep"
      selector:
        select:
          options:
            - aspira
            - cleangenius_deep
            - cleangenius_fast
            - custom_cleaning

    main_evening_step3_preset:
      name: ğŸ¯ Slot Principale - Sera - Preset Step 3
      description: ModalitÃ  di pulizia per il terzo passaggio (se abilitato)
      default: "cleangenius_deep"
      selector:
        select:
          options:
            - aspira
            - cleangenius_deep
            - cleangenius_fast
            - custom_cleaning

    main_morning_step3_preset:
      name: ğŸ¯ Slot Principale - Mattina - Preset Step 3
      description: ModalitÃ  di pulizia per il terzo passaggio (se abilitato)
      default: "cleangenius_deep"
      selector:
        select:
          options:
            - aspira
            - cleangenius_deep
            - cleangenius_fast
            - custom_cleaning

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # ğŸ“‹ SCHEDULAZIONE 1 (CON LOGICA ADATTIVA)
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    schedule1_enabled:
      name: ğŸ“‹ Abilita Schedulazione 1
      description: Attiva la prima schedulazione aggiuntiva con logica adattiva (salta se giÃ  pulito di recente)
      selector:
        boolean: {}

    schedule1_evening_time:
      name: â° Schedulazione 1 - Orario Serale
      description: Orario per la pulizia serale della prima schedulazione aggiuntiva
      default: "23:00:00"
      selector:
        time: {}

    schedule1_morning_time:
      name: â° Schedulazione 1 - Orario Mattutino
      description: Orario per la pulizia mattutina della prima schedulazione aggiuntiva
      default: "05:00:00"
      selector:
        time: {}

    schedule1_evening_weekdays:
      name: ğŸ“… Schedulazione 1 - Giorni Serali
      description: Giorni della settimana per pulizia serale della prima schedulazione aggiuntiva
      selector:
        select:
          multiple: true
          mode: dropdown
          options:
            - lunedÃ¬
            - martedÃ¬
            - mercoledÃ¬
            - giovedÃ¬
            - venerdÃ¬
            - sabato
            - domenica

    schedule1_morning_weekdays:
      name: ğŸ“… Schedulazione 1 - Giorni Mattutini
      description: Giorni della settimana per pulizia mattutina della prima schedulazione aggiuntiva
      selector:
        select:
          multiple: true
          mode: dropdown
          options:
            - lunedÃ¬
            - martedÃ¬
            - mercoledÃ¬
            - giovedÃ¬
            - venerdÃ¬
            - sabato
            - domenica

    schedule1_evening_preset:
      name: ğŸ¯ Schedulazione 1 - Sera - Preset Step 1
      description: ModalitÃ  per il primo passaggio della pulizia serale
      default: "aspira"
      selector:
        select:
          options:
            - aspira
            - cleangenius_deep
            - cleangenius_fast
            - custom_cleaning

    schedule1_morning_preset:
      name: ğŸ¯ Schedulazione 1 - Mattina - Preset Step 1
      description: ModalitÃ  per il primo passaggio della pulizia mattutina
      default: "aspira"
      selector:
        select:
          options:
            - aspira
            - cleangenius_deep
            - cleangenius_fast
            - custom_cleaning

    schedule1_evening_step2_preset:
      name: ğŸ¯ Schedulazione 1 - Sera - Preset Step 2
      description: ModalitÃ  per il secondo passaggio della pulizia serale
      default: "cleangenius_deep"
      selector:
        select:
          options:
            - aspira
            - cleangenius_deep
            - cleangenius_fast
            - custom_cleaning

    schedule1_morning_step2_preset:
      name: ğŸ¯ Schedulazione 1 - Mattina - Preset Step 2
      description: ModalitÃ  per il secondo passaggio della pulizia mattutina
      default: "cleangenius_deep"
      selector:
        select:
          options:
            - aspira
            - cleangenius_deep
            - cleangenius_fast
            - custom_cleaning

    schedule1_evening_step3_preset:
      name: ğŸ¯ Schedulazione 1 - Sera - Preset Step 3
      description: ModalitÃ  per il terzo passaggio della pulizia serale
      default: "cleangenius_deep"
      selector:
        select:
          options:
            - aspira
            - cleangenius_deep
            - cleangenius_fast
            - custom_cleaning

    schedule1_morning_step3_preset:
      name: ğŸ¯ Schedulazione 1 - Mattina - Preset Step 3
      description: ModalitÃ  per il terzo passaggio della pulizia mattutina
      default: "cleangenius_deep"
      selector:
        select:
          options:
            - aspira
            - cleangenius_deep
            - cleangenius_fast
            - custom_cleaning

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # ğŸ“‹ SCHEDULAZIONE 2 (CON LOGICA ADATTIVA)
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    schedule2_enabled:
      name: ğŸ“‹ Abilita Schedulazione 2
      description: Attiva la seconda schedulazione aggiuntiva con logica adattiva (salta se giÃ  pulito di recente)
      selector:
        boolean: {}

    schedule2_evening_time:
      name: â° Schedulazione 2 - Orario Serale
      description: Orario per la pulizia serale della seconda schedulazione aggiuntiva
      default: "23:00:00"
      selector:
        time: {}

    schedule2_morning_time:
      name: â° Schedulazione 2 - Orario Mattutino
      description: Orario per la pulizia mattutina della seconda schedulazione aggiuntiva
      default: "05:00:00"
      selector:
        time: {}

    schedule2_evening_weekdays:
      name: ğŸ“… Schedulazione 2 - Giorni Serali
      description: Giorni della settimana per pulizia serale della seconda schedulazione aggiuntiva
      selector:
        select:
          multiple: true
          mode: dropdown
          options:
            - lunedÃ¬
            - martedÃ¬
            - mercoledÃ¬
            - giovedÃ¬
            - venerdÃ¬
            - sabato
            - domenica

    schedule2_morning_weekdays:
      name: ğŸ“… Schedulazione 2 - Giorni Mattutini
      description: Giorni della settimana per pulizia mattutina della seconda schedulazione aggiuntiva
      default: ["domenica"]
      selector:
        select:
          multiple: true
          mode: dropdown
          options:
            - lunedÃ¬
            - martedÃ¬
            - mercoledÃ¬
            - giovedÃ¬
            - venerdÃ¬
            - sabato
            - domenica

    schedule2_evening_preset:
      name: ğŸ¯ Schedulazione 2 - Sera - Preset Step 1
      description: ModalitÃ  per il primo passaggio della pulizia serale
      default: "aspira"
      selector:
        select:
          options:
            - aspira
            - cleangenius_deep
            - cleangenius_fast
            - custom_cleaning

    schedule2_morning_preset:
      name: ğŸ¯ Schedulazione 2 - Mattina - Preset Step 1
      description: ModalitÃ  per il primo passaggio della pulizia mattutina
      default: "aspira"
      selector:
        select:
          options:
            - aspira
            - cleangenius_deep
            - cleangenius_fast
            - custom_cleaning

    schedule2_evening_step2_preset:
      name: ğŸ¯ Schedulazione 2 - Sera - Preset Step 2
      description: ModalitÃ  per il secondo passaggio della pulizia serale
      default: "cleangenius_deep"
      selector:
        select:
          options:
            - aspira
            - cleangenius_deep
            - cleangenius_fast
            - custom_cleaning

    schedule2_morning_step2_preset:
      name: ğŸ¯ Schedulazione 2 - Mattina - Preset Step 2
      description: ModalitÃ  per il secondo passaggio della pulizia mattutina
      default: "cleangenius_deep"
      selector:
        select:
          options:
            - aspira
            - cleangenius_deep
            - cleangenius_fast
            - custom_cleaning

    schedule2_evening_step3_preset:
      name: ğŸ¯ Schedulazione 2 - Sera - Preset Step 3
      description: ModalitÃ  per il terzo passaggio della pulizia serale
      default: "cleangenius_deep"
      selector:
        select:
          options:
            - aspira
            - cleangenius_deep
            - cleangenius_fast
            - custom_cleaning

    schedule2_morning_step3_preset:
      name: ğŸ¯ Schedulazione 2 - Mattina - Preset Step 3
      description: ModalitÃ  per il terzo passaggio della pulizia mattutina
      default: "cleangenius_deep"
      selector:
        select:
          options:
            - aspira
            - cleangenius_deep
            - cleangenius_fast
            - custom_cleaning

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # ğŸ“‹ SCHEDULAZIONE 3 (CON LOGICA ADATTIVA)
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    schedule3_enabled:
      name: ğŸ“‹ Abilita Schedulazione 3
      description: Attiva la terza schedulazione aggiuntiva con logica adattiva (salta se giÃ  pulito di recente)
      selector:
        boolean: {}

    schedule3_evening_time:
      name: â° Schedulazione 3 - Orario Serale
      description: Orario per la pulizia serale della terza schedulazione aggiuntiva
      default: "23:00:00"
      selector:
        time: {}

    schedule3_morning_time:
      name: â° Schedulazione 3 - Orario Mattutino
      description: Orario per la pulizia mattutina della terza schedulazione aggiuntiva
      default: "05:00:00"
      selector:
        time: {}

    schedule3_evening_weekdays:
      name: ğŸ“… Schedulazione 3 - Giorni Serali
      description: Giorni della settimana per pulizia serale della terza schedulazione aggiuntiva
      default: ["sabato"]
      selector:
        select:
          multiple: true
          mode: dropdown
          options:
            - lunedÃ¬
            - martedÃ¬
            - mercoledÃ¬
            - giovedÃ¬
            - venerdÃ¬
            - sabato
            - domenica

    schedule3_morning_weekdays:
      name: ğŸ“… Schedulazione 3 - Giorni Mattutini
      description: Giorni della settimana per pulizia mattutina della terza schedulazione aggiuntiva
      default: ["sabato"]
      selector:
        select:
          multiple: true
          mode: dropdown
          options:
            - lunedÃ¬
            - martedÃ¬
            - mercoledÃ¬
            - giovedÃ¬
            - venerdÃ¬
            - sabato
            - domenica

    schedule3_evening_preset:
      name: ğŸ¯ Schedulazione 3 - Sera - Preset Step 1
      description: ModalitÃ  per il primo passaggio della pulizia serale
      default: "aspira"
      selector:
        select:
          options:
            - aspira
            - cleangenius_deep
            - cleangenius_fast
            - custom_cleaning

    schedule3_morning_preset:
      name: ğŸ¯ Schedulazione 3 - Mattina - Preset Step 1
      description: ModalitÃ  per il primo passaggio della pulizia mattutina
      default: "aspira"
      selector:
        select:
          options:
            - aspira
            - cleangenius_deep
            - cleangenius_fast
            - custom_cleaning

    schedule3_evening_step2_preset:
      name: ğŸ¯ Schedulazione 3 - Sera - Preset Step 2
      description: ModalitÃ  per il secondo passaggio della pulizia serale
      default: "cleangenius_deep"
      selector:
        select:
          options:
            - aspira
            - cleangenius_deep
            - cleangenius_fast
            - custom_cleaning

    schedule3_morning_step2_preset:
      name: ğŸ¯ Schedulazione 3 - Mattina - Preset Step 2
      description: ModalitÃ  per il secondo passaggio della pulizia mattutina
      default: "cleangenius_deep"
      selector:
        select:
          options:
            - aspira
            - cleangenius_deep
            - cleangenius_fast
            - custom_cleaning

    schedule3_evening_step3_preset:
      name: ğŸ¯ Schedulazione 3 - Sera - Preset Step 3
      description: ModalitÃ  per il terzo passaggio della pulizia serale
      default: "cleangenius_deep"
      selector:
        select:
          options:
            - aspira
            - cleangenius_deep
            - cleangenius_fast
            - custom_cleaning

    schedule3_morning_step3_preset:
      name: ğŸ¯ Schedulazione 3 - Mattina - Preset Step 3
      description: ModalitÃ  per il terzo passaggio della pulizia mattutina
      default: "cleangenius_deep"
      selector:
        select:
          options:
            - aspira
            - cleangenius_deep
            - cleangenius_fast
            - custom_cleaning

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # ğŸ“‹ SCHEDULAZIONE 4 (CON LOGICA ADATTIVA)
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    schedule4_enabled:
      name: ğŸ“‹ Abilita Schedulazione 4
      description: Attiva la quarta schedulazione aggiuntiva con logica adattiva (salta se giÃ  pulito di recente)
      selector:
        boolean: {}

    schedule4_evening_time:
      name: â° Schedulazione 4 - Orario Serale
      description: Orario per la pulizia serale della quarta schedulazione aggiuntiva
      default: "23:00:00"
      selector:
        time: {}

    schedule4_morning_time:
      name: â° Schedulazione 4 - Orario Mattutino
      description: Orario per la pulizia mattutina della quarta schedulazione aggiuntiva
      default: "05:00:00"
      selector:
        time: {}

    schedule4_evening_weekdays:
      name: ğŸ“… Schedulazione 4 - Giorni Serali
      description: Giorni della settimana per pulizia serale della quarta schedulazione aggiuntiva
      default: ["domenica"]
      selector:
        select:
          multiple: true
          mode: dropdown
          options:
            - lunedÃ¬
            - martedÃ¬
            - mercoledÃ¬
            - giovedÃ¬
            - venerdÃ¬
            - sabato
            - domenica

    schedule4_morning_weekdays:
      name: ğŸ“… Schedulazione 4 - Giorni Mattutini
      description: Giorni della settimana per pulizia mattutina della quarta schedulazione aggiuntiva
      default: ["domenica"]
      selector:
        select:
          multiple: true
          mode: dropdown
          options:
            - lunedÃ¬
            - martedÃ¬
            - mercoledÃ¬
            - giovedÃ¬
            - venerdÃ¬
            - sabato
            - domenica

    schedule4_evening_preset:
      name: ğŸ¯ Schedulazione 4 - Sera - Preset Step 1
      description: ModalitÃ  per il primo passaggio della pulizia serale
      default: "aspira"
      selector:
        select:
          options:
            - aspira
            - cleangenius_deep
            - cleangenius_fast
            - custom_cleaning

    schedule4_morning_preset:
      name: ğŸ¯ Schedulazione 4 - Mattina - Preset Step 1
      description: ModalitÃ  per il primo passaggio della pulizia mattutina
      default: "aspira"
      selector:
        select:
          options:
            - aspira
            - cleangenius_deep
            - cleangenius_fast
            - custom_cleaning

    schedule4_evening_step2_preset:
      name: ğŸ¯ Schedulazione 4 - Sera - Preset Step 2
      description: ModalitÃ  per il secondo passaggio della pulizia serale
      default: "cleangenius_deep"
      selector:
        select:
          options:
            - aspira
            - cleangenius_deep
            - cleangenius_fast
            - custom_cleaning

    schedule4_morning_step2_preset:
      name: ğŸ¯ Schedulazione 4 - Mattina - Preset Step 2
      description: ModalitÃ  per il secondo passaggio della pulizia mattutina
      default: "cleangenius_deep"
      selector:
        select:
          options:
            - aspira
            - cleangenius_deep
            - cleangenius_fast
            - custom_cleaning

    schedule4_evening_step3_preset:
      name: ğŸ¯ Schedulazione 4 - Sera - Preset Step 3
      description: ModalitÃ  per il terzo passaggio della pulizia serale
      default: "cleangenius_deep"
      selector:
        select:
          options:
            - aspira
            - cleangenius_deep
            - cleangenius_fast
            - custom_cleaning

    schedule4_morning_step3_preset:
      name: ğŸ¯ Schedulazione 4 - Mattina - Preset Step 3
      description: ModalitÃ  per il terzo passaggio della pulizia mattutina
      default: "cleangenius_deep"
      selector:
        select:
          options:
            - aspira
            - cleangenius_deep
            - cleangenius_fast
            - custom_cleaning

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # âš™ï¸ IMPOSTAZIONI GLOBALI
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    delay_between_steps:
      name: â±ï¸ Pausa tra Passaggi
      description: Tempo di attesa in minuti tra un passaggio di pulizia e il successivo
      default: 5
      selector:
        number:
          min: 1
          max: 60
          unit_of_measurement: "minuti"

    max_cleaning_steps:
      name: ğŸ”¢ Numero Massimo Passaggi
      description: Numero massimo di passaggi di pulizia da eseguire per ogni sessione (1-3)
      default: 2
      selector:
        number:
          min: 1
          max: 3

    enable_adaptive_cleaning:
      name: ğŸ§  Abilita Logica Adattiva
      description: Attiva il controllo intelligente che evita pulizie ridondanti per le schedulazioni aggiuntive (non si applica al Slot Principale)
      selector:
        boolean: {}

    adaptive_threshold_hours:
      name: â° Soglia Adattiva (Ore)
      description: Numero di ore minime che devono trascorrere dall'ultima pulizia prima che una schedulazione aggiuntiva possa essere eseguita nuovamente
      default: 2
      selector:
        number:
          min: 0.5
          max: 24
          step: 0.5
          unit_of_measurement: "ore"

    main_flag_cleaned_today:
      name: ğŸ Sensore Ultima Pulizia
      description: Input boolean che tiene traccia dello stato di pulizia per la logica adattiva
      selector:
        entity:
          domain: input_boolean

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ”¥ SISTEMA TRIGGER
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
trigger:
  # SLOT PRINCIPALE
  - platform: time
    at: !input main_evening_time
    id: main_evening
  - platform: time
    at: !input main_morning_time
    id: main_morning
    
  # SCHEDULAZIONI AGGIUNTIVE  
  - platform: time
    at: !input schedule1_evening_time
    id: schedule1_evening
  - platform: time
    at: !input schedule1_morning_time
    id: schedule1_morning
  - platform: time
    at: !input schedule2_evening_time
    id: schedule2_evening
  - platform: time
    at: !input schedule2_morning_time
    id: schedule2_morning
  - platform: time
    at: !input schedule3_evening_time
    id: schedule3_evening
  - platform: time
    at: !input schedule3_morning_time
    id: schedule3_morning
  - platform: time
    at: !input schedule4_evening_time
    id: schedule4_evening
  - platform: time
    at: !input schedule4_morning_time
    id: schedule4_morning

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ›¡ï¸ CONDIZIONI GLOBALI
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
condition:
  # CONTROLLO GIORNO APPROPRIATO PER IL TRIGGER ATTIVATO
  - condition: template
    value_template: >
      {% set current_day = now().strftime('%A') %}
      {% set day_map = {
        'Monday': 'lunedÃ¬',
        'Tuesday': 'martedÃ¬', 
        'Wednesday': 'mercoledÃ¬',
        'Thursday': 'giovedÃ¬',
        'Friday': 'venerdÃ¬',
        'Saturday': 'sabato',
        'Sunday': 'domenica'
      } %}
      {% set today_italian = day_map[current_day] %}
      
      {% if trigger.id == 'main_evening' %}
        {{ main_schedule_enabled and today_italian in main_evening_weekdays }}
      {% elif trigger.id == 'main_morning' %}
        {{ main_schedule_enabled and today_italian in main_morning_weekdays }}
      {% elif trigger.id == 'schedule1_evening' %}
        {{ schedule1_enabled and today_italian in schedule1_evening_weekdays }}
      {% elif trigger.id == 'schedule1_morning' %}
        {{ schedule1_enabled and today_italian in schedule1_morning_weekdays }}
      {% elif trigger.id == 'schedule2_evening' %}
        {{ schedule2_enabled and today_italian in schedule2_evening_weekdays }}
      {% elif trigger.id == 'schedule2_morning' %}
        {{ schedule2_enabled and today_italian in schedule2_morning_weekdays }}
      {% elif trigger.id == 'schedule3_evening' %}
        {{ schedule3_enabled and today_italian in schedule3_evening_weekdays }}
      {% elif trigger.id == 'schedule3_morning' %}
        {{ schedule3_enabled and today_italian in schedule3_morning_weekdays }}
      {% elif trigger.id == 'schedule4_evening' %}
        {{ schedule4_enabled and today_italian in schedule4_evening_weekdays }}
      {% elif trigger.id == 'schedule4_morning' %}
        {{ schedule4_enabled and today_italian in schedule4_morning_weekdays }}
      {% else %}
        {{ false }}
      {% endif %}

  # CONTROLLO STATO ROBOT (HARDCODATO - CORRETTO!)
  - condition: template
    value_template: >
      {{ states(vacuum_entity) in ['idle', 'sleeping', 'charging', 'docked'] }}

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸš€ LOGICA DI ESECUZIONE
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
action:
  # CONTROLLO LOGICA ADATTIVA (SOLO PER SCHEDULAZIONI)
  - choose:
      - conditions:
          - condition: template
            value_template: >
              {{ enable_adaptive_cleaning and not trigger.id.startswith('main_') }}
          - condition: template
            value_template: >
              {% set last_cleaned = states(main_flag_cleaned_today) %}
              {% if last_cleaned == 'on' %}
                {% set last_change = state_attr(main_flag_cleaned_today, 'last_changed') %}
                {% if last_change %}
                  {% set hours_since = (now() - last_change).total_seconds() / 3600 %}
                  {{ hours_since < adaptive_threshold_hours }}
                {% else %}
                  {{ false }}
                {% endif %}
              {% else %}
                {{ false }}
              {% endif %}
        sequence:
          - service: persistent_notification.create
            data:
              title: "ğŸ¤– Robot - Pulizia Saltata"
              message: >
                Pulizia {{ trigger.id }} saltata per logica adattiva: 
                robot utilizzato di recente (meno di {{ adaptive_threshold_hours }} ore fa)
          - stop: "Pulizia saltata per logica adattiva"

  # DETERMINAZIONE PRESET BASATA SUL TRIGGER ATTIVATO
  - variables:
      current_preset: >
        {% if trigger.id == 'main_evening' %}
          {{ main_evening_preset }}
        {% elif trigger.id == 'main_morning' %}
          {{ main_morning_preset }}
        {% elif trigger.id == 'schedule1_evening' %}
          {{ schedule1_evening_preset }}
        {% elif trigger.id == 'schedule1_morning' %}
          {{ schedule1_morning_preset }}
        {% elif trigger.id == 'schedule2_evening' %}
          {{ schedule2_evening_preset }}
        {% elif trigger.id == 'schedule2_morning' %}
          {{ schedule2_morning_preset }}
        {% elif trigger.id == 'schedule3_evening' %}
          {{ schedule3_evening_preset }}
        {% elif trigger.id == 'schedule3_morning' %}
          {{ schedule3_morning_preset }}
        {% elif trigger.id == 'schedule4_evening' %}
          {{ schedule4_evening_preset }}
        {% elif trigger.id == 'schedule4_morning' %}
          {{ schedule4_morning_preset }}
        {% else %}
          aspira
        {% endif %}
        
      step2_preset: >
        {% if trigger.id == 'main_evening' %}
          {{ main_evening_step2_preset }}
        {% elif trigger.id == 'main_morning' %}
          {{ main_morning_step2_preset }}
        {% elif trigger.id == 'schedule1_evening' %}
          {{ schedule1_evening_step2_preset }}
        {% elif trigger.id == 'schedule1_morning' %}
          {{ schedule1_morning_step2_preset }}
        {% elif trigger.id == 'schedule2_evening' %}
          {{ schedule2_evening_step2_preset }}
        {% elif trigger.id == 'schedule2_morning' %}
          {{ schedule2_morning_step2_preset }}
        {% elif trigger.id == 'schedule3_evening' %}
          {{ schedule3_evening_step2_preset }}
        {% elif trigger.id == 'schedule3_morning' %}
          {{ schedule3_morning_step2_preset }}
        {% elif trigger.id == 'schedule4_evening' %}
          {{ schedule4_evening_step2_preset }}
        {% elif trigger.id == 'schedule4_morning' %}
          {{ schedule4_morning_step2_preset }}
        {% else %}
          cleangenius_deep
        {% endif %}
        
      step3_preset: >
        {% if trigger.id == 'main_evening' %}
          {{ main_evening_step3_preset }}
        {% elif trigger.id == 'main_morning' %}
          {{ main_morning_step3_preset }}
        {% elif trigger.id == 'schedule1_evening' %}
          {{ schedule1_evening_step3_preset }}
        {% elif trigger.id == 'schedule1_morning' %}
          {{ schedule1_morning_step3_preset }}
        {% elif trigger.id == 'schedule2_evening' %}
          {{ schedule2_evening_step3_preset }}
        {% elif trigger.id == 'schedule2_morning' %}
          {{ schedule2_morning_step3_preset }}
        {% elif trigger.id == 'schedule3_evening' %}
          {{ schedule3_evening_step3_preset }}
        {% elif trigger.id == 'schedule3_morning' %}
          {{ schedule3_morning_step3_preset }}
        {% elif trigger.id == 'schedule4_evening' %}
          {{ schedule4_evening_step3_preset }}
        {% elif trigger.id == 'schedule4_morning' %}
          {{ schedule4_morning_step3_preset }}
        {% else %}
          cleangenius_deep
        {% endif %}

  # PRIMO PASSAGGIO - AVVIO PULIZIA
  - service: vacuum.send_command
    target:
      entity_id: !input vacuum_entity
    data:
      command: "{{ current_preset }}"
      
  - service: persistent_notification.create
    data:
      title: "ğŸ¤– Robot - Avvio Pulizia"
      message: >
        Avviata {{ trigger.id }} - Step 1/{{ max_cleaning_steps }} 
        con modalitÃ  {{ current_preset }}
      
  # AGGIORNAMENTO FLAG DI PULIZIA
  - service: input_boolean.turn_on
    target:
      entity_id: !input main_flag_cleaned_today

  # ATTESA COMPLETAMENTO PRIMO PASSAGGIO
  - wait_template: >
      {{ states(vacuum_entity) in ['idle', 'sleeping', 'charging', 'docked'] }}
    timeout: "02:00:00"
    
  # ESECUZIONE PASSAGGI AGGIUNTIVI (SE CONFIGURATI)
  - repeat:
      count: "{{ max_cleaning_steps - 1 }}"
      sequence:
        # PAUSA TRA PASSAGGI
        - delay:
            minutes: "{{ delay_between_steps }}"
            
        - variables:
            current_step: "{{ repeat.index + 1 }}"
            next_preset: >
              {% if repeat.index == 1 %}
                {{ step2_preset }}
              {% elif repeat.index == 2 %}
                {{ step3_preset }}
              {% else %}
                {{ step2_preset }}
              {% endif %}
              
        # AVVIO PASSAGGIO SUCCESSIVO
        - service: vacuum.send_command
          target:
            entity_id: !input vacuum_entity
          data:
            command: "{{ next_preset }}"
            
        - service: persistent_notification.create
          data:
            title: "ğŸ¤– Robot - Step {{ current_step }}"
            message: >
              Avviato passaggio {{ current_step }}/{{ max_cleaning_steps }} 
              con modalitÃ  {{ next_preset }}
            
        # ATTESA COMPLETAMENTO PASSAGGIO
        - wait_template: >
            {{ states(vacuum_entity) in ['idle', 'sleeping', 'charging', 'docked'] }}
          timeout: "02:00:00"

  # NOTIFICA COMPLETAMENTO SESSIONE
  - service: persistent_notification.create
    data:
      title: "ğŸ‰ Robot - Pulizia Completata"
      message: >
        Sessione {{ trigger.id }} completata con successo!
        Eseguiti {{ max_cleaning_steps }} passaggi di pulizia.

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# âš™ï¸ CONFIGURAZIONI FINALI  
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
mode: queued
max: 10
